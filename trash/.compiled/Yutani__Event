#!/usr/bin/env bash
# Generated by Trashtalk Compiler (procyon) - DO NOT EDIT
# Source: Event.trash
# Generated: 2026-01-12T09:54:20

__Yutani__Event__superclass="Object"
__Yutani__Event__instanceVars="rawJson:{} eventType: widgetId: keyName: keyMods: mouseX: mouseY: mouseButton: data:"
__Yutani__Event__classInstanceVars=""
__Yutani__Event__traits=""
__Yutani__Event__sourceHash="d727857b61d9930ce8f6ec1e67284441ae213f66d18d47fe99e9bbe7a913f928"

__Yutani__Event__source() {
  cat <<'__TRASHTALK_SOURCE_EOF__'
package: Yutani

# Event - represents a UI event from Yutani server
# Refactored for optimized parsing with single jq call

Event subclass: Object
  instanceVars: rawJson:'{}' eventType:'' widgetId:'' keyName:'' keyMods:'' mouseX:'' mouseY:'' mouseButton:'' data:''

  # ============================================================================
  # Factory - Optimized single-jq-call parsing
  # ============================================================================

  # Parse a JSON event string into an Event object
  # Uses single jq invocation to extract all fields at once
  rawClassMethod: fromJson: json [
    local json="$1"
    local instance parsed type_field
    local wid kname kmods mx my mbutton wdata

    instance=$(_generate_instance_id "Yutani__Event")
    _create_instance "Yutani::Event" "$instance"

    # Store raw JSON
    @ "$instance" _setRawJson: "$json"

    # Single jq call to extract all fields and determine event type
    # Output format: type|widgetId|keyName|keyMods|mouseX|mouseY|mouseButton|data
    parsed=$(echo "$json" | jq -r '
      if .key then
        "key|\(.widget.widgetId.id // "")|\(.key.key // "")|\(.key.modifiers // "")|0|0||"
      elif .widget then
        "widget|\(.widget.widgetId.id // "")|||0|0||\(.widget.type // "")"
      elif .mouse then
        "mouse||||\(.mouse.x // 0)|\(.mouse.y // 0)|\(.mouse.button // "")|"
      elif .resize then
        "resize|||0|0||"
      elif .focus then
        "focus|||0|0||"
      else
        "unknown|||0|0||"
      end
    ')

    # Parse the pipe-delimited result
    IFS='|' read -r type_field wid kname kmods mx my mbutton wdata <<< "$parsed"

    # Set all fields
    @ "$instance" _setEventType: "$type_field"
    [[ -n "$wid" ]] && @ "$instance" _setWidgetId: "$wid"
    [[ -n "$kname" ]] && @ "$instance" _setKeyName: "$kname"
    [[ -n "$kmods" ]] && @ "$instance" _setKeyMods: "$kmods"
    [[ -n "$mx" && "$mx" != "0" ]] && @ "$instance" _setMouseX: "$mx"
    [[ -n "$my" && "$my" != "0" ]] && @ "$instance" _setMouseY: "$my"
    [[ -n "$mbutton" ]] && @ "$instance" _setMouseButton: "$mbutton"
    [[ -n "$wdata" ]] && @ "$instance" _setData: "$wdata"

    echo "$instance"
  ]

  # ============================================================================
  # Type Checking
  # ============================================================================

  rawMethod: isKeyEvent [
    [[ "$(_ivar eventType)" == "key" ]] && echo "true" || echo "false"
  ]

  rawMethod: isWidgetEvent [
    [[ "$(_ivar eventType)" == "widget" ]] && echo "true" || echo "false"
  ]

  rawMethod: isMouseEvent [
    [[ "$(_ivar eventType)" == "mouse" ]] && echo "true" || echo "false"
  ]

  rawMethod: isResizeEvent [
    [[ "$(_ivar eventType)" == "resize" ]] && echo "true" || echo "false"
  ]

  rawMethod: isFocusEvent [
    [[ "$(_ivar eventType)" == "focus" ]] && echo "true" || echo "false"
  ]

  # ============================================================================
  # Accessors (auto-generated by instanceVars, no need to define explicitly)
  # ============================================================================

  # ============================================================================
  # Widget Event Helpers (lazy extraction from raw JSON)
  # ============================================================================

  # Get widget event type (WIDGET_CHANGED, WIDGET_DONE, etc.)
  method: widgetEventType [
    | widget |
    widget := rawJson objectAt: 'widget'.
    ^ widget objectAt: 'type'
  ]

  # Get widget event data object
  method: widgetData [
    | widget |
    widget := rawJson objectAt: 'widget'.
    ^ widget objectAt: 'data'
  ]

  # Get specific widget data field
  method: widgetDataAt: key [
    | widget widgetDataObj |
    widget := rawJson objectAt: 'widget'.
    widgetDataObj := widget objectAt: 'data'.
    ^ widgetDataObj objectAt: key
  ]

  # ============================================================================
  # Key Event Helpers
  # ============================================================================

  rawMethod: isKey: keyToCheck [
    local keyToCheck="$1"
    [[ "$(_ivar keyName)" == "$keyToCheck" ]] && echo "true" || echo "false"
  ]

  rawMethod: isEnterKey [
    [[ "$(_ivar keyName)" == "KEY_ENTER" ]] && echo "true" || echo "false"
  ]

  rawMethod: isEscapeKey [
    [[ "$(_ivar keyName)" == "KEY_ESC" ]] && echo "true" || echo "false"
  ]

  rawMethod: isTabKey [
    [[ "$(_ivar keyName)" == "KEY_TAB" ]] && echo "true" || echo "false"
  ]

  rawMethod: isCtrlC [
    [[ "$(_ivar keyName)" == "KEY_CTRL_C" ]] && echo "true" || echo "false"
  ]

  rawMethod: isCtrlD [
    [[ "$(_ivar keyName)" == "KEY_CTRL_D" ]] && echo "true" || echo "false"
  ]

  rawMethod: isCtrlL [
    [[ "$(_ivar keyName)" == "KEY_CTRL_L" ]] && echo "true" || echo "false"
  ]

  # ============================================================================
  # Widget Submission Helper
  # ============================================================================

  # Check if widget event is submission (WIDGET_DONE from Yutani)
  rawMethod: isSubmission [
    local wt
    wt=$(@ "$_RECEIVER" widgetEventType)
    [[ "$wt" == "WIDGET_DONE" ]] && echo "true" || echo "false"
  ]

  # ============================================================================
  # Private Setters
  # ============================================================================

  method: _setRawJson: v [ rawJson := v ]
  method: _setEventType: v [ eventType := v ]
  method: _setWidgetId: v [ widgetId := v ]
  method: _setKeyName: v [ keyName := v ]
  method: _setKeyMods: v [ keyMods := v ]
  method: _setMouseX: v [ mouseX := v ]
  method: _setMouseY: v [ mouseY := v ]
  method: _setMouseButton: v [ mouseButton := v ]
  method: _setData: v [ data := v ]

__TRASHTALK_SOURCE_EOF__
}

__Yutani__Event__rawJson() {
  echo "$(_ivar rawJson)"; return
}

__Yutani__Event__rawJson_() {
  _ivar_set rawJson "$1"
}

__Yutani__Event__eventType() {
  echo "$(_ivar eventType)"; return
}

__Yutani__Event__eventType_() {
  _ivar_set eventType "$1"
}

__Yutani__Event__widgetId() {
  echo "$(_ivar widgetId)"; return
}

__Yutani__Event__widgetId_() {
  _ivar_set widgetId "$1"
}

__Yutani__Event__keyName() {
  echo "$(_ivar keyName)"; return
}

__Yutani__Event__keyName_() {
  _ivar_set keyName "$1"
}

__Yutani__Event__keyMods() {
  echo "$(_ivar keyMods)"; return
}

__Yutani__Event__keyMods_() {
  _ivar_set keyMods "$1"
}

__Yutani__Event__mouseX() {
  echo "$(_ivar mouseX)"; return
}

__Yutani__Event__mouseX_() {
  _ivar_set mouseX "$1"
}

__Yutani__Event__mouseY() {
  echo "$(_ivar mouseY)"; return
}

__Yutani__Event__mouseY_() {
  _ivar_set mouseY "$1"
}

__Yutani__Event__mouseButton() {
  echo "$(_ivar mouseButton)"; return
}

__Yutani__Event__mouseButton_() {
  _ivar_set mouseButton "$1"
}

__Yutani__Event__data() {
  echo "$(_ivar data)"; return
}

__Yutani__Event__data_() {
  _ivar_set data "$1"
}

__Yutani__Event__class__fromJson_() {
  local json="$1"
  local json="$1"
  local instance parsed type_field
  local wid kname kmods mx my mbutton wdata
  instance=$(_generate_instance_id "Yutani__Event")
  _create_instance "Yutani::Event" "$instance"
  # Store raw JSON
  @ "$instance" _setRawJson: "$json"
  # Single jq call to extract all fields and determine event type
  # Output format: type|widgetId|keyName|keyMods|mouseX|mouseY|mouseButton|data
  parsed=$(echo "$json" | jq -r '
  if .key then
  "key|\(.widget.widgetId.id // "")|\(.key.key // "")|\(.key.modifiers // "")|0|0||"
  elif .widget then
  "widget|\(.widget.widgetId.id // "")|||0|0||\(.widget.type // "")"
  elif .mouse then
  "mouse||||\(.mouse.x // 0)|\(.mouse.y // 0)|\(.mouse.button // "")|"
  elif .resize then
  "resize|||0|0||"
  elif .focus then
  "focus|||0|0||"
  else
  "unknown|||0|0||"
  end
  ')
  # Parse the pipe-delimited result
  IFS='|' read -r type_field wid kname kmods mx my mbutton wdata <<< "$parsed"
  # Set all fields
  @ "$instance" _setEventType: "$type_field"
  [[ -n "$wid" ]] && @ "$instance" _setWidgetId: "$wid"
  [[ -n "$kname" ]] && @ "$instance" _setKeyName: "$kname"
  [[ -n "$kmods" ]] && @ "$instance" _setKeyMods: "$kmods"
  [[ -n "$mx" && "$mx" != "0" ]] && @ "$instance" _setMouseX: "$mx"
  [[ -n "$my" && "$my" != "0" ]] && @ "$instance" _setMouseY: "$my"
  [[ -n "$mbutton" ]] && @ "$instance" _setMouseButton: "$mbutton"
  [[ -n "$wdata" ]] && @ "$instance" _setData: "$wdata"
  echo "$instance"
}

__Yutani__Event__isKeyEvent() {
  [[ "$(_ivar eventType)" == "key" ]] && echo "true" || echo "false"
}

__Yutani__Event__isWidgetEvent() {
  [[ "$(_ivar eventType)" == "widget" ]] && echo "true" || echo "false"
}

__Yutani__Event__isMouseEvent() {
  [[ "$(_ivar eventType)" == "mouse" ]] && echo "true" || echo "false"
}

__Yutani__Event__isResizeEvent() {
  [[ "$(_ivar eventType)" == "resize" ]] && echo "true" || echo "false"
}

__Yutani__Event__isFocusEvent() {
  [[ "$(_ivar eventType)" == "focus" ]] && echo "true" || echo "false"
}

__Yutani__Event__widgetEventType() {
  local widget
  widget="$(echo "$(_ivar rawJson)" | jq -r --arg k "widget" '.[$k] // empty')"
  echo "$(echo "$widget" | jq -r --arg k "type" '.[$k] // empty')"; return
}

__Yutani__Event__widgetData() {
  local widget
  widget="$(echo "$(_ivar rawJson)" | jq -r --arg k "widget" '.[$k] // empty')"
  echo "$(echo "$widget" | jq -r --arg k "data" '.[$k] // empty')"; return
}

__Yutani__Event__widgetDataAt_() {
  local key="$1"
  local widget widgetDataObj
  widget="$(echo "$(_ivar rawJson)" | jq -r --arg k "widget" '.[$k] // empty')"
  widgetDataObj="$(echo "$widget" | jq -r --arg k "data" '.[$k] // empty')"
  echo "$(echo "$widgetDataObj" | jq -r --arg k "$key" '.[$k] // empty')"; return
}

__Yutani__Event__isKey_() {
  local keyToCheck="$1"
  local keyToCheck="$1"
  [[ "$(_ivar keyName)" == "$keyToCheck" ]] && echo "true" || echo "false"
}

__Yutani__Event__isEnterKey() {
  [[ "$(_ivar keyName)" == "KEY_ENTER" ]] && echo "true" || echo "false"
}

__Yutani__Event__isEscapeKey() {
  [[ "$(_ivar keyName)" == "KEY_ESC" ]] && echo "true" || echo "false"
}

__Yutani__Event__isTabKey() {
  [[ "$(_ivar keyName)" == "KEY_TAB" ]] && echo "true" || echo "false"
}

__Yutani__Event__isCtrlC() {
  [[ "$(_ivar keyName)" == "KEY_CTRL_C" ]] && echo "true" || echo "false"
}

__Yutani__Event__isCtrlD() {
  [[ "$(_ivar keyName)" == "KEY_CTRL_D" ]] && echo "true" || echo "false"
}

__Yutani__Event__isCtrlL() {
  [[ "$(_ivar keyName)" == "KEY_CTRL_L" ]] && echo "true" || echo "false"
}

__Yutani__Event__isSubmission() {
  local wt
  wt=$(@ "$_RECEIVER" widgetEventType)
  [[ "$wt" == "WIDGET_DONE" ]] && echo "true" || echo "false"
}

__Yutani__Event___setRawJson_() {
  local v="$1"
  _ivar_set rawJson "$v"
}

__Yutani__Event___setEventType_() {
  local v="$1"
  _ivar_set eventType "$v"
}

__Yutani__Event___setWidgetId_() {
  local v="$1"
  _ivar_set widgetId "$v"
}

__Yutani__Event___setKeyName_() {
  local v="$1"
  _ivar_set keyName "$v"
}

__Yutani__Event___setKeyMods_() {
  local v="$1"
  _ivar_set keyMods "$v"
}

__Yutani__Event___setMouseX_() {
  local v="$1"
  _ivar_set mouseX "$v"
}

__Yutani__Event___setMouseY_() {
  local v="$1"
  _ivar_set mouseY "$v"
}

__Yutani__Event___setMouseButton_() {
  local v="$1"
  _ivar_set mouseButton "$v"
}

__Yutani__Event___setData_() {
  local v="$1"
  _ivar_set data "$v"
}

