#!/usr/bin/env bash
# Generated by Trashtalk Compiler (jq) - DO NOT EDIT
# Source: Array.trash
# Generated: 2026-01-04T02:40:06

__Array__superclass="Object"
__Array__instanceVars="items:[]"
__Array__classInstanceVars=""
__Array__traits="Debuggable Persistable"
__Array__sourceHash="3c8221dc4d8cfa78f7de697c6dfac51a22bf8b735b98be0fbdc75a16f5cc08c4"

__Array__source() {
  cat <<'__TRASHTALK_SOURCE_EOF__'
# Array - Collection object for managing lists
Array subclass: Object
  include: Debuggable
  include: Persistable
  instanceVars: items:'[]'

  # Create a new array
  method: new [
    | array_id |
    array_id := $(_generate_instance_id "Array")
    _create_instance "Array" "$array_id"
    ^ $array_id
  ]

  # Accessor for items ivar
  rawMethod: getItems [
    echo "$(_ivar items)"
  ]

  # Setter for items ivar
  rawMethod: setItems: newItems [
    _ivar_set items "$1"
  ]

  # Private helper - get the raw items JSON array
  rawMethod: _getItemsArray [
    local items
    items="$(_ivar items)"
    echo "${items:-[]}"
  ]

  # Get element at index
  method: at: index [
    | items |
    items := $(@ self _getItemsArray)
    echo "$items" | jq -r ".[$index] // empty"
  ]

  # Set element at index
  method: at: index put: value [
    | items new_items |
    items := $(@ self _getItemsArray)
    new_items := $(echo "$items" | jq -c ".[$index] = \"$value\"")
    @ self setItems: "$new_items"
    ^ $value
  ]

  # Add element to end
  method: push: value [
    | items new_items |
    items := $(@ self _getItemsArray)
    new_items := $(echo "$items" | jq -c ". + [\"$value\"]")
    @ self setItems: "$new_items"
    ^ $value
  ]

  # Remove and return last element
  method: pop [
    | items last new_items |
    items := $(@ self _getItemsArray)
    last := $(echo "$items" | jq -r '.[-1] // empty')
    new_items := $(echo "$items" | jq -c '.[0:-1]')
    @ self setItems: "$new_items"
    ^ $last
  ]

  # Get array length
  method: size [
    | items |
    items := $(@ self _getItemsArray)
    echo "$items" | jq 'length'
  ]

  # Print array contents
  method: show [
    | items len |
    items := $(@ self _getItemsArray)
    len := $(echo "$items" | jq 'length')
    if [[ "$len" -eq 0 ]]; then
      echo "(empty array)"
    else
      echo "$items" | jq -r '.[]' | nl -v0 | sed 's/^[ \t]*//'
    fi
  ]

  # Initialize with values
  method: withValues: values [
    | items value |
    items := "[]"
    for value in $values; do
      items := $(echo "$items" | jq -c ". + [\"$value\"]")
    done
    @ self setItems: "$items"
    ^ self
  ]

  # Iterate over each element, calling block with each value
  # Usage: @ myArray do: [:each | @ Console print: each]
  rawMethod: do: block [
    local items len i element block_id="$1"
    items=$(@ "$_RECEIVER" _getItemsArray)
    len=$(echo "$items" | jq 'length')

    for ((i=0; i<len; i++)); do
      element=$(echo "$items" | jq -r ".[$i]")
      @ "$block_id" valueWith: "$element"
    done
  ]

  # Map each element through a block, returning new array
  # Usage: doubled := @ myArray collect: [:x | x * 2]
  rawMethod: collect: block [
    local items len i element result new_items block_id="$1"
    items=$(@ "$_RECEIVER" _getItemsArray)
    len=$(echo "$items" | jq 'length')
    new_items="[]"

    for ((i=0; i<len; i++)); do
      element=$(echo "$items" | jq -r ".[$i]")
      result=$(@ "$block_id" valueWith "$element")
      new_items=$(echo "$new_items" | jq -c ". + [\"$result\"]")
    done

    # Create new Array with results
    local new_array
    new_array=$(@ Array new)
    @ "$new_array" setItems: "$new_items"
    echo "$new_array"
  ]

  # Select elements where block returns true (non-empty string)
  rawMethod: select: block [
    local items len i element result new_items block_id="$1"
    items=$(@ "$_RECEIVER" _getItemsArray)
    len=$(echo "$items" | jq 'length')
    new_items="[]"

    for ((i=0; i<len; i++)); do
      element=$(echo "$items" | jq -r ".[$i]")
      result=$(@ "$block_id" valueWith "$element")
      # Non-empty result means true
      if [[ -n "$result" ]]; then
        new_items=$(echo "$new_items" | jq -c ". + [\"$element\"]")
      fi
    done

    # Create new Array with selected elements
    local new_array
    new_array=$(@ Array new)
    @ "$new_array" setItems: "$new_items"
    echo "$new_array"
  ]

  # Reduce array to single value using block
  # Usage: sum := @ myArray inject: 0 into: [:acc :each | acc + each]
  rawMethod: inject: initial into: block [
    local items len i element acc block_id="$2"
    items=$(@ "$_RECEIVER" _getItemsArray)
    len=$(echo "$items" | jq 'length')
    acc="$1"

    for ((i=0; i<len; i++)); do
      element=$(echo "$items" | jq -r ".[$i]")
      acc=$(@ "$block_id" valueWith: "$acc" and: "$element")
    done

    echo "$acc"
  ]
__TRASHTALK_SOURCE_EOF__
}

__Array__items() {
  echo "$(_ivar items)"; return
}

__Array__items_() {
  _ivar_set items "$1"
}

__Array__getItems() {
  echo "$(_ivar items)"; return
}

__Array__setItems_() {
  _ivar_set items "$1"
}

__Array__new() {
  local array_id
  array_id=$(_generate_instance_id "Array")
  _create_instance "Array" "$array_id"
  echo $array_id
}

__Array__getItems() {
    echo "$(_ivar items)"
}

__Array__setItems_() {
  local newItems="$1"
    _ivar_set items "$1"
}

__Array___getItemsArray() {
    local items
    items="$(_ivar items)"
    echo "${items:-[]}"
}

__Array__at_() {
  local index="$1"
  local items
  items=$(@ $_RECEIVER _getItemsArray)
  echo "$items" | jq -r ".[$index] // empty"
}

__Array__at_put_() {
  local index="$1"
  local value="$2"
  local items new_items
  items="$(@ "$_RECEIVER" _getItemsArray)"
  new_items="$(echo "$items" | jq -c ".[$index] = \"$value\"")"
  @ "$_RECEIVER" setItems: "$new_items"
  echo "$value"; return
}

__Array__push_() {
  local value="$1"
  local items new_items
  items="$(@ "$_RECEIVER" _getItemsArray)"
  new_items="$(echo "$items" | jq -c ". + [\"$value\"]")"
  @ "$_RECEIVER" setItems: "$new_items"
  echo "$value"; return
}

__Array__pop() {
  local items last new_items
  items="$(@ "$_RECEIVER" _getItemsArray)"
  last="$(echo "$items" | jq -r '.[-1] // empty')"
  new_items="$(echo "$items" | jq -c '.[0:-1]')"
  @ "$_RECEIVER" setItems: "$new_items"
  echo "$last"; return
}

__Array__size() {
  local items
  items=$(@ $_RECEIVER _getItemsArray)
  echo "$items" | jq 'length'
}

__Array__show() {
  local items len
  items=$(@ $_RECEIVER _getItemsArray)
  len=$(echo "$items" | jq 'length')
  if [[ "$len" -eq 0 ]]; then
  echo "(empty array)"
  else
  echo "$items" | jq -r '.[]' | nl -v0 | sed 's/^[ \t]*//'
  fi
}

__Array__withValues_() {
  local values="$1"
  local items value
  items="[]"
  for value in $values; do
  items=$(echo "$items" | jq -c ". + [\"$value\"]")
  done
  @ "$_RECEIVER" setItems: "$items"
  echo $_RECEIVER
}

__Array__do_() {
  local block="$1"
    local items len i element block_id="$1"
    items=$(@ "$_RECEIVER" _getItemsArray)
    len=$(echo "$items" | jq 'length')

    for ((i=0; i<len; i++)); do
        element=$(echo "$items" | jq -r ".[$i]")
        @ "$block_id" valueWith: "$element"
    done
}

__Array__collect_() {
  local block="$1"
    local items len i element result new_items block_id="$1"
    items=$(@ "$_RECEIVER" _getItemsArray)
    len=$(echo "$items" | jq 'length')
    new_items="[]"

    for ((i=0; i<len; i++)); do
        element=$(echo "$items" | jq -r ".[$i]")
        result=$(@ "$block_id" valueWith "$element")
        new_items=$(echo "$new_items" | jq -c ". + [\"$result\"]")
    done

    # Create new Array with results
    local new_array
    new_array=$(@ Array new)
    @ "$new_array" setItems: "$new_items"
    echo "$new_array"
}

__Array__select_() {
  local block="$1"
    local items len i element result new_items block_id="$1"
    items=$(@ "$_RECEIVER" _getItemsArray)
    len=$(echo "$items" | jq 'length')
    new_items="[]"

    for ((i=0; i<len; i++)); do
        element=$(echo "$items" | jq -r ".[$i]")
        result=$(@ "$block_id" valueWith "$element")
        # Non-empty result means true
        if [[ -n "$result" ]]; then
            new_items=$(echo "$new_items" | jq -c ". + [\"$element\"]")
        fi
    done

    # Create new Array with selected elements
    local new_array
    new_array=$(@ Array new)
    @ "$new_array" setItems: "$new_items"
    echo "$new_array"
}

__Array__inject_into_() {
  local initial="$1"
  local block="$2"
    local items len i element acc block_id="$2"
    items=$(@ "$_RECEIVER" _getItemsArray)
    len=$(echo "$items" | jq 'length')
    acc="$1"

    for ((i=0; i<len; i++)); do
        element=$(echo "$items" | jq -r ".[$i]")
        acc=$(@ "$block_id" valueWith: "$acc" and: "$element")
    done

    echo "$acc"
}
