#!/usr/bin/env bash
# Generated by Trashtalk Compiler (jq) - DO NOT EDIT
# Source: Time.trash
# Generated: 2026-01-09T21:24:52

__Time__superclass="Object"
__Time__instanceVars=""
__Time__classInstanceVars=""
__Time__traits=""
__Time__sourceHash="a9eca03c216f02dced0f4a87ce8fe18672d7570e172c505a2cfcb4ff2816a6bc"

__Time__source() {
  cat <<'__TRASHTALK_SOURCE_EOF__'
# Time - Time and date primitive class
# Provides time operations: timestamps, formatting, delays
#
# Usage:
#   now := @ Time now
#   @ Time sleep: 0.5
#   formatted := @ Time format: now as: '%Y-%m-%d'
#
Time subclass: Object

  # ==========================================
  # Current Time
  # ==========================================

  # Get current Unix timestamp (seconds since epoch)
  # Usage: ts := @ Time now
  rawClassMethod: now [
    date +%s
  ]

  # Get current time in milliseconds
  # Usage: ms := @ Time nowMillis
  rawClassMethod: nowMillis [
    if [[ "$OSTYPE" == "darwin"* ]]; then
      # macOS: use perl for milliseconds
      perl -MTime::HiRes=time -e 'printf "%.0f\n", time * 1000'
    else
      # Linux: date supports nanoseconds
      date +%s%3N
    fi
  ]

  # Get current time formatted
  # Usage: str := @ Time nowFormatted: '%Y-%m-%d %H:%M:%S'
  rawClassMethod: nowFormatted: format [
    date +"$1"
  ]

  # Get ISO 8601 formatted current time
  # Usage: iso := @ Time nowISO
  rawClassMethod: nowISO [
    date -u +"%Y-%m-%dT%H:%M:%SZ"
  ]

  # ==========================================
  # Formatting
  # ==========================================

  # Format a Unix timestamp
  # Usage: str := @ Time format: timestamp as: '%Y-%m-%d'
  rawClassMethod: format: timestamp as: format [
    if [[ "$OSTYPE" == "darwin"* ]]; then
      date -r "$1" +"$2"
    else
      date -d "@$1" +"$2"
    fi
  ]

  # Format timestamp as ISO 8601
  # Usage: iso := @ Time formatISO: timestamp
  rawClassMethod: formatISO: timestamp [
    if [[ "$OSTYPE" == "darwin"* ]]; then
      date -r "$1" -u +"%Y-%m-%dT%H:%M:%SZ"
    else
      date -d "@$1" -u +"%Y-%m-%dT%H:%M:%SZ"
    fi
  ]

  # Format timestamp as human-readable relative time
  # Usage: str := @ Time formatRelative: timestamp  # "5 minutes ago"
  rawClassMethod: formatRelative: timestamp [
    local now diff
    now=$(date +%s)
    diff=$((now - $1))

    if [[ $diff -lt 60 ]]; then
      echo "${diff} seconds ago"
    elif [[ $diff -lt 3600 ]]; then
      echo "$((diff / 60)) minutes ago"
    elif [[ $diff -lt 86400 ]]; then
      echo "$((diff / 3600)) hours ago"
    else
      echo "$((diff / 86400)) days ago"
    fi
  ]

  # ==========================================
  # Parsing
  # ==========================================

  # Parse a date string to Unix timestamp
  # Usage: ts := @ Time parse: '2024-01-15' format: '%Y-%m-%d'
  rawClassMethod: parse: dateString format: format [
    if [[ "$OSTYPE" == "darwin"* ]]; then
      date -j -f "$2" "$1" +%s 2>/dev/null || echo ""
    else
      date -d "$1" +%s 2>/dev/null || echo ""
    fi
  ]

  # ==========================================
  # Delays
  # ==========================================

  # Sleep for specified seconds (supports decimals)
  # Usage: @ Time sleep: 0.5
  rawClassMethod: sleep: seconds [
    sleep "$1"
  ]

  # Sleep for specified milliseconds
  # Usage: @ Time sleepMillis: 100
  rawClassMethod: sleepMillis: millis [
    sleep "$(echo "scale=3; $1 / 1000" | bc)"
  ]

  # ==========================================
  # Duration/Arithmetic
  # ==========================================

  # Calculate duration between two timestamps
  # Usage: duration := @ Time since: startTime
  rawClassMethod: since: startTime [
    local now
    now=$(date +%s)
    echo $((now - $1))
  ]

  # Calculate duration between two timestamps
  # Usage: duration := @ Time from: startTime to: endTime
  rawClassMethod: from: startTime to: endTime [
    echo $(($2 - $1))
  ]

  # Add seconds to a timestamp
  # Usage: future := @ Time add: 3600 to: timestamp
  rawClassMethod: add: seconds to: timestamp [
    echo $(($2 + $1))
  ]

  # Subtract seconds from a timestamp
  # Usage: past := @ Time subtract: 3600 from: timestamp
  rawClassMethod: subtract: seconds from: timestamp [
    echo $(($2 - $1))
  ]

  # ==========================================
  # Components
  # ==========================================

  # Get year from timestamp
  rawClassMethod: yearOf: timestamp [
    @ "$_CLASS" format: "$1" as: "%Y"
  ]

  # Get month from timestamp (1-12)
  rawClassMethod: monthOf: timestamp [
    @ "$_CLASS" format: "$1" as: "%-m"
  ]

  # Get day of month from timestamp (1-31)
  rawClassMethod: dayOf: timestamp [
    @ "$_CLASS" format: "$1" as: "%-d"
  ]

  # Get hour from timestamp (0-23)
  rawClassMethod: hourOf: timestamp [
    @ "$_CLASS" format: "$1" as: "%-H"
  ]

  # Get minute from timestamp (0-59)
  rawClassMethod: minuteOf: timestamp [
    @ "$_CLASS" format: "$1" as: "%-M"
  ]

  # Get second from timestamp (0-59)
  rawClassMethod: secondOf: timestamp [
    @ "$_CLASS" format: "$1" as: "%-S"
  ]

  # Get day of week (0=Sunday, 6=Saturday)
  rawClassMethod: weekdayOf: timestamp [
    @ "$_CLASS" format: "$1" as: "%w"
  ]

  # ==========================================
  # Convenience
  # ==========================================

  # Get timestamp for start of today
  rawClassMethod: today [
    if [[ "$OSTYPE" == "darwin"* ]]; then
      date -j -f "%Y-%m-%d" "$(date +%Y-%m-%d)" +%s
    else
      date -d "$(date +%Y-%m-%d)" +%s
    fi
  ]

  # Get timestamp for start of tomorrow
  rawClassMethod: tomorrow [
    local today
    today=$(@ "$_CLASS" today)
    echo $((today + 86400))
  ]

  # Get timestamp for start of yesterday
  rawClassMethod: yesterday [
    local today
    today=$(@ "$_CLASS" today)
    echo $((today - 86400))
  ]
__TRASHTALK_SOURCE_EOF__
}

__Time__class__now() {
    date +%s
}

__Time__class__nowMillis() {
    if [[ "$OSTYPE" == "darwin"* ]]; then
        # macOS: use perl for milliseconds
        perl -MTime :: HiRes= time -e 'printf "%.0f\n", time* 1000'
        else
        # Linux: date supports nanoseconds
        date +%s %3 N
    fi
}

__Time__class__nowFormatted_() {
  local format="$1"
    date +"$1"
}

__Time__class__nowISO() {
    date -u +"%Y-%m-%dT%H:%M:%SZ"
}

__Time__class__format_as_() {
  local timestamp="$1"
  local format="$2"
    if [[ "$OSTYPE" == "darwin"* ]]; then
        date -r "$1" +"$2"
        else
        date -d "@$1" +"$2"
    fi
}

__Time__class__formatISO_() {
  local timestamp="$1"
    if [[ "$OSTYPE" == "darwin"* ]]; then
        date -r "$1" -u +"%Y-%m-%dT%H:%M:%SZ"
        else
        date -d "@$1" -u +"%Y-%m-%dT%H:%M:%SZ"
    fi
}

__Time__class__formatRelative_() {
  local timestamp="$1"
    local now diff
    now=$(date +%s)
    diff=$((now - $1))

    if [[ $diff -lt 60 ]]; then
        echo "${diff} seconds ago"
        elif [[ $diff -lt 3600 ]]; then
            echo "$((diff / 60)) minutes ago"
            elif [[ $diff -lt 86400 ]]; then
                echo "$((diff / 3600)) hours ago"
                else
                echo "$((diff / 86400)) days ago"
            fi
}

__Time__class__parse_format_() {
  local dateString="$1"
  local format="$2"
    if [[ "$OSTYPE" == "darwin"* ]]; then
        date -j -f "$2" "$1" +%s 2>/dev/null || echo ""
        else
        date -d "$1" +%s 2>/dev/null || echo ""
    fi
}

__Time__class__sleep_() {
  local seconds="$1"
    sleep "$1"
}

__Time__class__sleepMillis_() {
  local millis="$1"
    sleep "$(echo "scale=3; $1 / 1000" | bc)"
}

__Time__class__since_() {
  local startTime="$1"
    local now
    now=$(date +%s)
    echo $((now - $1))
}

__Time__class__from_to_() {
  local startTime="$1"
  local endTime="$2"
    echo $(($2 - $1))
}

__Time__class__add_to_() {
  local seconds="$1"
  local timestamp="$2"
    echo $(($2 + $1))
}

__Time__class__subtract_from_() {
  local seconds="$1"
  local timestamp="$2"
    echo $(($2 - $1))
}

__Time__class__yearOf_() {
  local timestamp="$1"
    @ "$_CLASS" format: "$1" as: "%Y"
}

__Time__class__monthOf_() {
  local timestamp="$1"
    @ "$_CLASS" format: "$1" as: "%-m"
}

__Time__class__dayOf_() {
  local timestamp="$1"
    @ "$_CLASS" format: "$1" as: "%-d"
}

__Time__class__hourOf_() {
  local timestamp="$1"
    @ "$_CLASS" format: "$1" as: "%-H"
}

__Time__class__minuteOf_() {
  local timestamp="$1"
    @ "$_CLASS" format: "$1" as: "%-M"
}

__Time__class__secondOf_() {
  local timestamp="$1"
    @ "$_CLASS" format: "$1" as: "%-S"
}

__Time__class__weekdayOf_() {
  local timestamp="$1"
    @ "$_CLASS" format: "$1" as: "%w"
}

__Time__class__today() {
    if [[ "$OSTYPE" == "darwin"* ]]; then
        date -j -f "%Y-%m-%d" "$(date +%Y-%m-%d)" +%s
        else
        date -d "$(date +%Y-%m-%d)" +%s
    fi
}

__Time__class__tomorrow() {
    local today
    today=$(@ "$_CLASS" today)
    echo $((today + 86400))
}

__Time__class__yesterday() {
    local today
    today=$(@ "$_CLASS" today)
    echo $((today - 86400))
}
