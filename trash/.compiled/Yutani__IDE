#!/usr/bin/env bash
# Generated by Trashtalk Compiler (jq) - DO NOT EDIT
# Source: IDE.trash
# Generated: 2026-01-09T21:44:07

__Yutani__IDE__superclass="Yutani::Application"
__Yutani__IDE__instanceVars="outputView: inputField: layout: history:"
__Yutani__IDE__classInstanceVars=""
__Yutani__IDE__traits=""
__Yutani__IDE__sourceHash="7bf9d53d5f3c81d6e75c17fa75b2d43c85a6a5d659ba821f8557d740082b654b"
__Yutani__IDE__package="Yutani"
__Yutani__IDE__qualifiedName="Yutani::IDE"

__Yutani__IDE__source() {
  cat <<'__TRASHTALK_SOURCE_EOF__'
package: Yutani

IDE subclass: Yutani::Application
  instanceVars: outputView:'' inputField:'' layout:'' history:''

  # Override setup to build the UI
  rawMethod: setup [
    local layout outputView inputField initialText

    # Create layout
    layout=$(@ "$_RECEIVER" createVerticalLayout)
    _ivar_set layout "$layout"

    # Create output view
    initialText="Trashtalk IDE - Type code and press Enter
"
    outputView=$(@ "$_RECEIVER" createTextView: "Transcript" text: "$initialText")
    _ivar_set outputView "$outputView"
    _ivar_set history "$initialText"

    # Create input field
    inputField=$(@ "$_RECEIVER" createInputField: ">" placeholder: "Enter code...")
    _ivar_set inputField "$inputField"

    # Add to layout
    @ "$layout" addChild: "$outputView"
    @ "$layout" addChild: "$inputField" fixedSize: 3 focus: true

    # Set root
    @ "$_RECEIVER" setRoot: "$layout"

    # Register event handlers - embed instance ID at registration time
    local submitHandler keyHandler
    printf -v submitHandler '@ "%s" evaluateInput: "$__TEXT"' "$_RECEIVER"
    printf -v keyHandler '@ "%s" handleKey: "$__EVENT"' "$_RECEIVER"

    @ "$inputField" onSubmitDo: "$submitHandler"
    @ "$_RECEIVER" onKeyDo: "$keyHandler"
  ]

  # Handle key events
  rawMethod: handleKey: event [
    local event="$1" keyName inputField

    keyName=$(@ "$event" keyName)
    inputField="$(_ivar inputField)"

    case "$keyName" in
      KEY_CTRL_C|KEY_CTRL_D)
        @ "$_RECEIVER" stop
        ;;
      KEY_TAB)
        @ "$inputField" focus
        ;;
      KEY_ESC)
        @ "$inputField" clear
        @ "$inputField" focus
        ;;
    esac
  ]

  # Evaluate input text
  rawMethod: evaluateInput: text [
    local text="$1" result inputField outputView newText

    if [[ -z "$text" ]]; then
      return
    fi

    inputField="$(_ivar inputField)"
    outputView="$(_ivar outputView)"

    # Evaluate the code
    result=$(@ Trash eval: "$text" 2>&1)

    # Build output
    newText="> ${text}
${result}

"

    # Append to output
    @ "$_RECEIVER" appendOutput: "$newText"

    # Clear and refocus input
    @ "$inputField" clear
    @ "$inputField" focus
  ]

  # Append text to output
  rawMethod: appendOutput: text [
    local text="$1" outputView history
    outputView="$(_ivar outputView)"
    history="$(_ivar history)"

    history="${history}${text}"
    _ivar_set history "$history"

    @ "$outputView" setText: "$history"
  ]
__TRASHTALK_SOURCE_EOF__
}

__Yutani__IDE__outputView() {
  echo "$(_ivar outputView)"; return
}

__Yutani__IDE__outputView_() {
  _ivar_set outputView "$1"
}

__Yutani__IDE__getOutputView() {
  echo "$(_ivar outputView)"; return
}

__Yutani__IDE__setOutputView_() {
  _ivar_set outputView "$1"
}
__Yutani__IDE__inputField() {
  echo "$(_ivar inputField)"; return
}

__Yutani__IDE__inputField_() {
  _ivar_set inputField "$1"
}

__Yutani__IDE__getInputField() {
  echo "$(_ivar inputField)"; return
}

__Yutani__IDE__setInputField_() {
  _ivar_set inputField "$1"
}
__Yutani__IDE__layout() {
  echo "$(_ivar layout)"; return
}

__Yutani__IDE__layout_() {
  _ivar_set layout "$1"
}

__Yutani__IDE__getLayout() {
  echo "$(_ivar layout)"; return
}

__Yutani__IDE__setLayout_() {
  _ivar_set layout "$1"
}
__Yutani__IDE__history() {
  echo "$(_ivar history)"; return
}

__Yutani__IDE__history_() {
  _ivar_set history "$1"
}

__Yutani__IDE__getHistory() {
  echo "$(_ivar history)"; return
}

__Yutani__IDE__setHistory_() {
  _ivar_set history "$1"
}

__Yutani__IDE__setup() {
    local layout outputView inputField initialText

    # Create layout
    layout=$(@ "$_RECEIVER" createVerticalLayout)
    _ivar_set layout "$layout"

    # Create output view
    initialText="Trashtalk IDE - Type code and press Enter
    "
    outputView=$(@ "$_RECEIVER" createTextView: "Transcript" text: "$initialText")
    _ivar_set outputView "$outputView"
    _ivar_set history "$initialText"

    # Create input field
    inputField=$(@ "$_RECEIVER" createInputField: ">" placeholder: "Enter code...")
    _ivar_set inputField "$inputField"

    # Add to layout
    @ "$layout" addChild: "$outputView"
    @ "$layout" addChild: "$inputField" fixedSize: 3 focus: true

    # Set root
    @ "$_RECEIVER" setRoot: "$layout"

    # Register event handlers - embed instance ID at registration time
    local submitHandler keyHandler
    printf -v submitHandler '@ "%s" evaluateInput: "$__TEXT"' "$_RECEIVER"
    printf -v keyHandler '@ "%s" handleKey: "$__EVENT"' "$_RECEIVER"

    @ "$inputField" onSubmitDo: "$submitHandler"
    @ "$_RECEIVER" onKeyDo: "$keyHandler"
}

__Yutani__IDE__handleKey_() {
  local event="$1"
    local event="$1" keyName inputField

    keyName=$(@ "$event" keyName)
    inputField="$(_ivar inputField)"

    case "$keyName" in
        KEY_CTRL_C | KEY_CTRL_D)
        @ "$_RECEIVER" stop
    ;;
        KEY_TAB)
        @ "$inputField" focus
    ;;
        KEY_ESC)
        @ "$inputField" clear
        @ "$inputField" focus
    ;;
    esac
}

__Yutani__IDE__evaluateInput_() {
  local text="$1"
    local text="$1" result inputField outputView newText

    if [[ -z "$text" ]]; then
        return
    fi

    inputField="$(_ivar inputField)"
    outputView="$(_ivar outputView)"

    # Evaluate the code
    result=$(@ Trash eval: "$text" 2>&1)

    # Build output
    newText="> ${text}
    ${result}

    "

    # Append to output
    @ "$_RECEIVER" appendOutput: "$newText"

    # Clear and refocus input
    @ "$inputField" clear
    @ "$inputField" focus
}

__Yutani__IDE__appendOutput_() {
  local text="$1"
    local text="$1" outputView history
    outputView="$(_ivar outputView)"
    history="$(_ivar history)"

    history="${history}${text}"
    _ivar_set history "$history"

    @ "$outputView" setText: "$history"
}
