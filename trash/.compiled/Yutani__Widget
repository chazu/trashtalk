#!/usr/bin/env bash
# Generated by Trashtalk Compiler (jq) - DO NOT EDIT
# Source: Widget.trash
# Generated: 2026-01-07T14:08:29

__Yutani__Widget__superclass="Object"
__Yutani__Widget__instanceVars="session: widgetId: title: dispatcher:"
__Yutani__Widget__classInstanceVars=""
__Yutani__Widget__traits=""
__Yutani__Widget__sourceHash="402acaabdcfa2c9ff93bf02b60c4e9836af4ee645f346d9b6f60f02fdddf0ca1"
__Yutani__Widget__package="Yutani"
__Yutani__Widget__qualifiedName="Yutani::Widget"

__Yutani__Widget__source() {
  cat <<'__TRASHTALK_SOURCE_EOF__'
package: Yutani

Widget subclass: Object
  instanceVars: session:'' widgetId:'' title:'' dispatcher:''

  # Session accessor
  method: getSession [
    ^ session
  ]

  method: setSession: s [
    session := s
  ]

  # Widget ID accessor
  method: getWidgetId [
    ^ widgetId
  ]

  method: setWidgetId: id [
    widgetId := id
  ]

  # Title accessor
  method: getTitle [
    ^ title
  ]

  method: setTitle: t [
    title := t
  ]

  # Dispatcher accessor
  method: getDispatcher [
    ^ dispatcher
  ]

  method: setDispatcher: d [
    dispatcher := d
  ]

  # Delete this widget from the session
  rawMethod: delete [
    local session wid dispatcher
    session="$(_ivar session)"
    wid="$(_ivar widgetId)"
    dispatcher="$(_ivar dispatcher)"
    # Remove handler from dispatcher
    if [[ -n "$dispatcher" && -n "$wid" ]]; then
      @ "$dispatcher" removeHandlerFor: "$wid"
    fi
    # Delete from server
    if [[ -n "$session" && -n "$wid" ]]; then
      @ "$session" deleteWidget: "$wid"
    fi
  ]

  # Focus this widget
  rawMethod: focus [
    local session wid
    session="$(_ivar session)"
    wid="$(_ivar widgetId)"
    if [[ -n "$session" && -n "$wid" ]]; then
      @ "$session" focusWidget: "$wid"
    fi
  ]

  # Register an event handler for this widget
  # Handler is eval'd with $__EVENT set to the Event instance
  rawMethod: onEventDo: handler [
    local handler="$1" dispatcher wid
    dispatcher="$(_ivar dispatcher)"
    wid="$(_ivar widgetId)"
    if [[ -n "$dispatcher" && -n "$wid" ]]; then
      @ "$dispatcher" onWidget: "$wid" do: "$handler"
    fi
  ]

  # Convenience: Register handler for submission events
  # Handler receives $__EVENT and $__TEXT (submitted text)
  # Note: WIDGET_CHANGED stores text, WIDGET_DONE triggers handler with stored text
  rawMethod: onSubmitDo: handler [
    local handler="$1" dispatcher wid wrappedHandler storageVar
    dispatcher="$(_ivar dispatcher)"
    wid="$(_ivar widgetId)"
    if [[ -n "$dispatcher" && -n "$wid" ]]; then
      # Use a temp file to store text (shell vars don't persist across subshell calls)
      local storageFile="/tmp/yutani_text_${wid}.txt"
      # Wrap handler to store text on CHANGED and fire on DONE
      printf -v wrappedHandler '__wt=$(@ "$__EVENT" widgetEventType); if [[ "$__wt" == "WIDGET_CHANGED" ]]; then @ "$__EVENT" widgetDataAt: "text" > %s; elif [[ "$__wt" == "WIDGET_DONE" ]]; then __TEXT=$(cat %s 2>/dev/null); %s; fi' "$storageFile" "$storageFile" "$handler"
      @ "$dispatcher" onWidget: "$wid" do: "$wrappedHandler"
    else
      echo "[WIDGET] Missing dispatcher or wid, not registering" >&2
    fi
  ]
__TRASHTALK_SOURCE_EOF__
}

__Yutani__Widget__session() {
  echo "$(_ivar session)"; return
}

__Yutani__Widget__session_() {
  _ivar_set session "$1"
}

__Yutani__Widget__getSession() {
  echo "$(_ivar session)"; return
}

__Yutani__Widget__setSession_() {
  _ivar_set session "$1"
}
__Yutani__Widget__widgetId() {
  echo "$(_ivar widgetId)"; return
}

__Yutani__Widget__widgetId_() {
  _ivar_set widgetId "$1"
}

__Yutani__Widget__getWidgetId() {
  echo "$(_ivar widgetId)"; return
}

__Yutani__Widget__setWidgetId_() {
  _ivar_set widgetId "$1"
}
__Yutani__Widget__title() {
  echo "$(_ivar title)"; return
}

__Yutani__Widget__title_() {
  _ivar_set title "$1"
}

__Yutani__Widget__getTitle() {
  echo "$(_ivar title)"; return
}

__Yutani__Widget__setTitle_() {
  _ivar_set title "$1"
}
__Yutani__Widget__dispatcher() {
  echo "$(_ivar dispatcher)"; return
}

__Yutani__Widget__dispatcher_() {
  _ivar_set dispatcher "$1"
}

__Yutani__Widget__getDispatcher() {
  echo "$(_ivar dispatcher)"; return
}

__Yutani__Widget__setDispatcher_() {
  _ivar_set dispatcher "$1"
}

__Yutani__Widget__getSession() {
  echo "$(_ivar session)"; return
}

__Yutani__Widget__setSession_() {
  local s="$1"
  _ivar_set session "$s"
}

__Yutani__Widget__getWidgetId() {
  echo "$(_ivar widgetId)"; return
}

__Yutani__Widget__setWidgetId_() {
  local id="$1"
  _ivar_set widgetId "$id"
}

__Yutani__Widget__getTitle() {
  echo "$(_ivar title)"; return
}

__Yutani__Widget__setTitle_() {
  local t="$1"
  _ivar_set title "$t"
}

__Yutani__Widget__getDispatcher() {
  echo "$(_ivar dispatcher)"; return
}

__Yutani__Widget__setDispatcher_() {
  local d="$1"
  _ivar_set dispatcher "$d"
}

__Yutani__Widget__delete() {
    local session wid dispatcher
    session="$(_ivar session)"
    wid="$(_ivar widgetId)"
    dispatcher="$(_ivar dispatcher)"
    # Remove handler from dispatcher
    if [[ -n "$dispatcher" && -n "$wid" ]]; then
        @ "$dispatcher" removeHandlerFor: "$wid"
    fi
    # Delete from server
    if [[ -n "$session" && -n "$wid" ]]; then
        @ "$session" deleteWidget: "$wid"
    fi
}

__Yutani__Widget__focus() {
    local session wid
    session="$(_ivar session)"
    wid="$(_ivar widgetId)"
    if [[ -n "$session" && -n "$wid" ]]; then
        @ "$session" focusWidget: "$wid"
    fi
}

__Yutani__Widget__onEventDo_() {
  local handler="$1"
    local handler="$1" dispatcher wid
    dispatcher="$(_ivar dispatcher)"
    wid="$(_ivar widgetId)"
    if [[ -n "$dispatcher" && -n "$wid" ]]; then
        @ "$dispatcher" onWidget: "$wid" do: "$handler"
    fi
}

__Yutani__Widget__onSubmitDo_() {
  local handler="$1"
    local handler="$1" dispatcher wid wrappedHandler storageVar
    dispatcher="$(_ivar dispatcher)"
    wid="$(_ivar widgetId)"
    if [[ -n "$dispatcher" && -n "$wid" ]]; then
        # Use a temp file to store text (shell vars don't persist across subshell calls)
        local storageFile="/tmp/yutani_text_${wid}.txt"
        # Wrap handler to store text on CHANGED and fire on DONE
        printf -v wrappedHandler '__wt=$(@ "$__EVENT" widgetEventType); if [[ "$__wt" == "WIDGET_CHANGED" ]]; then @ "$__EVENT" widgetDataAt: "text" > %s; elif [[ "$__wt" == "WIDGET_DONE" ]]; then __TEXT=$(cat %s 2>/dev/null); %s; fi' "$storageFile" "$storageFile" "$handler"
        @ "$dispatcher" onWidget: "$wid" do: "$wrappedHandler"
        else
        echo "[WIDGET] Missing dispatcher or wid, not registering" >&2
    fi
}
