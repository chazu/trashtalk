#!/usr/bin/env bash
# Generated by Trashtalk Compiler (jq) - DO NOT EDIT
# Source: Object.trash
# Generated: 2025-12-23T14:27:22

__Object__superclass="nil"
__Object__instanceVars=""
__Object__classInstanceVars=""
__Object__traits=""

__Object__printString() {
    echo "<${_CLASS} ${_INSTANCE}>"
}

__Object__class() {
    echo "$_CLASS"
}

__Object__id() {
    echo "$_INSTANCE"
}

__Object__isKindOf_() {
  local className="$1"
    local current="$_CLASS"
    while [[ -n "$current" ]]; do
        if [[ "$current" == "$className" ]]; then
            echo "true"
            return 0
        fi
        local super_var="__${current}__superclass"
        current="${!super_var:-}"
    done
    echo "false"
}

__Object__conformsTo_() {
  local protocolName="$1"
    _conforms_to "$_CLASS" "$protocolName"
}

__Object__delete() {
    _delete_instance "$_INSTANCE"
}

__Object__inspect() {
    local data
    data=$(db_get "$_RECEIVER" 2>/dev/null)

    echo "a $_CLASS"
    echo " id: $_INSTANCE"

    if [[ -n "$data" && "$data" != "{}" ]]; then
        echo "DATA FOUND"
        echo "$data" | jq -r 'to_entries | .[] | " \(.key): \(.value)"'
    fi
}

__Object__inspectTo_() {
  local filepath="$1"
    @ "$_RECEIVER" inspect >"$filepath"
    echo "$filepath"
}

__Object__class__findAll() {
    db_find_by_class "$_CLASS"
}

__Object__class__count() {
    db_count_by_class "$_CLASS"
}

__Object__class__find() {
    local predicate="$1"

    if [[ -z "$predicate" ]]; then
        db_find_by_class "$_CLASS"
        return
    fi

    # Parse predicate using helper function from runtime
    _find_with_predicate "$_CLASS" "$predicate"
}

__Object__asJson() {
    db_get "$_RECEIVER"
}

__Object__class__edit() {
    local source_file="$TRASHDIR/${_CLASS}.trash"
    local trait_source="$TRASHDIR/traits/${_CLASS}.trash"
    local file_to_edit=""

    # Find source file
    if [[ -f "$source_file" ]]; then
    file_to_edit="$source_file"
        elif [[ -f "$trait_source" ]]; then
        file_to_edit="$trait_source"
            else
            echo "Error: No source file found for $_CLASS"
            return 1
        fi

        # Get modification time before editing
        local before_mtime after_mtime
        before_mtime=$(stat -f "%m" "$file_to_edit" 2>/dev/null || stat -c "%Y" "$file_to_edit" 2>/dev/null)

        # Open in editor
        ${EDITOR:-vi} "$file_to_edit" </dev/tty >/dev/tty

        # Check if modified and recompile
        after_mtime=$(stat -f "%m" "$file_to_edit" 2>/dev/null || stat -c "%Y" "$file_to_edit" 2>/dev/null)

        if [[ "$before_mtime" != "$after_mtime" ]]; then
            echo "File modified, compiling..."
            @ Trash compileAndReload "$_CLASS"
            else
            echo "No changes detected"
        fi
}
