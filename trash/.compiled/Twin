#!/usr/bin/env bash
# Generated by Trashtalk Compiler (jq) - DO NOT EDIT
# Source: Twin.trash
# Generated: 2026-01-04T02:40:32

__Twin__superclass="Object"
__Twin__instanceVars=""
__Twin__classInstanceVars=""
__Twin__traits="Debuggable"
__Twin__sourceHash="9c371702ce8da83e601493630607af27ba57543222aea64b11f3b0a8ac93462e"

__Twin__source() {
  cat <<'__TRASHTALK_SOURCE_EOF__'
# Twin - Window manager integration via twsendmsg
# Provides an interface to the Twin terminal multiplexer
Twin subclass: Object
  include: Debuggable

  # NOTE: Twin cannot be started via @ because the command substitution
  # prevents terminal control. Start Twin directly from bash:
  #
  #   TERM=xterm-256color twin --hw=tty
  #
  # Or add to ~/.bashrc:
  #   twin-start() { TERM=xterm-256color twin --hw=tty; }
  #
  # Then inside Twin, source Trashtalk and use @ Twin open: etc.

  # Show how to start Twin
  rawClassMethod: howToStart [
    echo "Twin cannot be started via @ (needs direct terminal control)."
    echo ""
    echo "Start Twin directly:"
    echo "  TERM=xterm-256color twin --hw=tty"
    echo ""
    echo "Or add to ~/.bashrc:"
    echo "  twin-start() { TERM=xterm-256color twin --hw=tty; }"
    echo ""
    echo "Then inside Twin:"
    echo "  source ~/.trashtalk/lib/trash.bash"
    echo "  @ Twin open: \"htop\""
  ]

  # Open a new terminal window running a command
  # Usage: @ Twin open: "vim /tmp/scratch.st"
  rawClassMethod: open: command [
    twsendmsg "twin" open "$command" 2>/dev/null
  ]

  # Open an empty terminal window
  # Usage: @ Twin openTerminal
  rawClassMethod: openTerminal [
    twsendmsg "twin" open "" 2>/dev/null
  ]

  # Open a file in the default editor
  # Usage: @ Twin edit: "/path/to/file"
  rawClassMethod: edit: filepath [
    local editor="${EDITOR:-vi}"
    twsendmsg "twin" open "$editor $filepath" 2>/dev/null
  ]

  # Open an inspector window for an object
  # Writes object info to temp file and opens in less
  # Usage: @ Twin inspect: $someObject
  rawClassMethod: inspect: object [
    local tmpfile
    tmpfile=$(mktemp -t "st-inspect-XXXXXX")

    # Write object inspection to file
    @ "$object" inspect > "$tmpfile" 2>&1

    # Open in less
    twsendmsg "twin" open "less $tmpfile" 2>/dev/null
  ]

  # Open a workspace file
  # Creates temp file and opens in editor, optionally evaluates on save
  # Usage: @ Twin workspace
  rawClassMethod: workspace [
    local tmpfile
    tmpfile=$(mktemp -t "st-workspace-XXXXXX.bash")

    # Create with header comment
    printf '# Trashtalk Workspace\n# Write code and save to evaluate\n\n' > "$tmpfile"

    local editor="${EDITOR:-vi}"
    twsendmsg "twin" open "$editor $tmpfile" 2>/dev/null

    echo "$tmpfile"
  ]

  # Open a viewer for any command output
  # Usage: @ Twin view: "ls -la"
  rawClassMethod: view: command [
    twsendmsg "twin" open "bash -c '$command | less'" 2>/dev/null
  ]

  # Open htop or top for system monitoring
  # Usage: @ Twin monitor
  rawClassMethod: monitor [
    if command -v htop >/dev/null 2>&1; then
      twsendmsg "twin" open "htop" 2>/dev/null
    else
      twsendmsg "twin" open "top" 2>/dev/null
    fi
  ]

  # Check if Twin is available
  # Usage: @ Twin isAvailable
  rawClassMethod: isAvailable [
    if command -v twsendmsg >/dev/null 2>&1; then
      echo "true"
    else
      echo "false"
    fi
  ]

  # Open a FIFO-connected window for streaming data
  # Returns the FIFO path for writing data to the window
  # Usage: fifo=$(@ Twin openStream: "Logs")
  rawClassMethod: openStream: title [
    local fifoPath
    fifoPath=$(mktemp -u -t "st-stream-XXXXXX")
    mkfifo "$fifoPath"

    # Open window that reads from FIFO
    twsendmsg "twin" open "cat $fifoPath | less -S -R +F" 2>/dev/null

    echo "$fifoPath"
  ]

  # Send data to a stream FIFO
  # Usage: @ Twin sendTo: $fifoPath data: "log message"
  rawClassMethod: sendTo: fifoPath data: message [
    echo "$message" >> "$fifoPath"
  ]

  # Close a stream by sending EOF
  # Usage: @ Twin closeStream: $fifoPath
  rawClassMethod: closeStream: fifoPath [
    # Close the FIFO
    exec 3>"$fifoPath"
    exec 3>&-
    rm -f "$fifoPath"
  ]

  # Show help
  rawClassMethod: help [
    echo "=== Twin Window Manager ==="
    echo ""
    echo "Starting Twin (run directly, not via @):"
    echo "  TERM=xterm-256color twin --hw=tty"
    echo "  @ Twin howToStart               - Show startup instructions"
    echo ""
    echo "Window Operations (run from inside Twin):"
    echo "  @ Twin open: \"command\"         - Open terminal running command"
    echo "  @ Twin openTerminal             - Open empty terminal"
    echo "  @ Twin edit: \"/path/file\"       - Open file in \$EDITOR"
    echo "  @ Twin inspect: \$obj            - Open object inspector"
    echo "  @ Twin workspace                - Open code workspace"
    echo ""
    echo "Viewing:"
    echo "  @ Twin view: \"ls -la\"           - View command output"
    echo "  @ Twin monitor                  - Open htop/top"
    echo ""
    echo "Streaming (for live data):"
    echo "  fifo=\$(@ Twin openStream: \"title\")  - Open stream window"
    echo "  @ Twin sendTo: \$fifo data: \"msg\"    - Send data to stream"
    echo "  @ Twin closeStream: \$fifo           - Close stream"
    echo ""
    echo "Utilities:"
    echo "  @ Twin isAvailable              - Check if Twin is installed"
  ]
__TRASHTALK_SOURCE_EOF__
}

__Twin__class__howToStart() {
    echo "Twin cannot be started via @ (needs direct terminal control)."
    echo ""
    echo "Start Twin directly:"
    echo " TERM=xterm-256color twin --hw=tty"
    echo ""
    echo "Or add to ~/.bashrc:"
    echo " twin-start() { TERM=xterm-256color twin --hw=tty; }"
    echo ""
    echo "Then inside Twin:"
    echo " source ~/.trashtalk/lib/trash.bash"
    echo " @ Twin open: \" htop \""
}

__Twin__class__open_() {
  local command="$1"
    twsendmsg "twin" open "$command" 2>/dev/null
}

__Twin__class__openTerminal() {
    twsendmsg "twin" open "" 2>/dev/null
}

__Twin__class__edit_() {
  local filepath="$1"
    local editor="${EDITOR:-vi}"
    twsendmsg "twin" open "$editor $filepath" 2>/dev/null
}

__Twin__class__inspect_() {
  local object="$1"
    local tmpfile
    tmpfile=$(mktemp -t "st-inspect-XXXXXX")

    # Write object inspection to file
    @ "$object" inspect >"$tmpfile" 2>&1

    # Open in less
    twsendmsg "twin" open "less $tmpfile" 2>/dev/null
}

__Twin__class__workspace() {
    local tmpfile
    tmpfile=$(mktemp -t "st-workspace-XXXXXX.bash")

    # Create with header comment
    printf '# Trashtalk Workspace\n# Write code and save to evaluate\n\n' >"$tmpfile"

    local editor="${EDITOR:-vi}"
    twsendmsg "twin" open "$editor $tmpfile" 2>/dev/null

    echo "$tmpfile"
}

__Twin__class__view_() {
  local command="$1"
    twsendmsg "twin" open "bash -c '$command | less'" 2>/dev/null
}

__Twin__class__monitor() {
    if command -v htop >/dev/null 2>&1; then
        twsendmsg "twin" open "htop" 2>/dev/null
        else
        twsendmsg "twin" open "top" 2>/dev/null
    fi
}

__Twin__class__isAvailable() {
    if command -v twsendmsg >/dev/null 2>&1; then
        echo "true"
        else
        echo "false"
    fi
}

__Twin__class__openStream_() {
  local title="$1"
    local fifoPath
    fifoPath=$(mktemp -u -t "st-stream-XXXXXX")
    mkfifo "$fifoPath"

    # Open window that reads from FIFO
    twsendmsg "twin" open "cat $fifoPath | less -S -R +F" 2>/dev/null

    echo "$fifoPath"
}

__Twin__class__sendTo_data_() {
  local fifoPath="$1"
  local message="$2"
    echo "$message" >>"$fifoPath"
}

__Twin__class__closeStream_() {
  local fifoPath="$1"
    # Close the FIFO
    exec 3>"$fifoPath"
    exec 3>&-
    rm -f "$fifoPath"
}

__Twin__class__help() {
    echo "=== Twin Window Manager ==="
    echo ""
    echo "Starting Twin (run directly, not via @):"
    echo " TERM=xterm-256color twin --hw=tty"
    echo " @ Twin howToStart - Show startup instructions"
    echo ""
    echo "Window Operations (run from inside Twin):"
    echo " @ Twin open: \" command \" - Open terminal running command"
    echo " @ Twin openTerminal - Open empty terminal"
    echo " @ Twin edit: \" /path/file \" - Open file in \$EDITOR"
    echo " @ Twin inspect: \$obj - Open object inspector"
    echo " @ Twin workspace - Open code workspace"
    echo ""
    echo "Viewing:"
    echo " @ Twin view: \" ls -la \" - View command output"
    echo " @ Twin monitor - Open htop/top"
    echo ""
    echo "Streaming (for live data):"
    echo " fifo=\$(@ Twin openStream: \"title\") - Open stream window"
    echo " @ Twin sendTo: \$fifo data: \" msg \" - Send data to stream"
    echo " @ Twin closeStream: \$fifo - Close stream"
    echo ""
    echo "Utilities:"
    echo " @ Twin isAvailable - Check if Twin is installed"
}
