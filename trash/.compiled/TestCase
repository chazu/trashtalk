#!/usr/bin/env bash
# Generated by Trashtalk Compiler (jq) - DO NOT EDIT
# Source: TestCase.trash
# Generated: 2026-01-06T01:26:25

__TestCase__superclass="Object"
__TestCase__instanceVars="passed:0 failed:0 skipped:0 currentTest:unknown"
__TestCase__classInstanceVars=""
__TestCase__traits=""
__TestCase__sourceHash="a75c63ea68a34f5cb9eda858d4851564545ba1e6e467196fe2fdf486df609524"

__TestCase__source() {
  cat <<'__TRASHTALK_SOURCE_EOF__'
# TestCase - Simple test framework for Trashtalk
# Subclass this and add methods starting with "test"
# Run with: @ YourTestClass runAll
TestCase subclass: Object
  instanceVars: passed:0 failed:0 skipped:0 currentTest:'unknown'

  rawClassMethod: new [
    local id
    id=$(_generate_instance_id "$_CLASS")
    _create_instance "$_CLASS" "$id"
    echo "$id"
  ]

  # Override in subclass for test setup
  method: setUp [
    ^ nil
  ]

  # Override in subclass for test cleanup
  method: tearDown [
    ^ nil
  ]

  # ==========================================
  # Equality Assertions
  # ==========================================

  method: assert: actual equals: expected [
    (actual = expected) ifTrue: [@ self _pass]
                        ifFalse: [@ self _fail: 'Values not equal']
  ]

  # Snake_case alias for positional args: @ self assert_equals "a" "b"
  rawMethod: assert_equals [
    local actual="$1"
    local expected="$2"
    @ "$_RECEIVER" assert: "$actual" equals: "$expected"
  ]

  method: assert: actual notEquals: expected [
    (actual ~= expected) ifTrue: [@ self _pass]
                         ifFalse: [@ self _fail: 'Values should not be equal']
  ]

  # Snake_case alias for positional args
  rawMethod: assert_not_equals [
    local actual="$1"
    local expected="$2"
    @ "$_RECEIVER" assert: "$actual" notEquals: "$expected"
  ]

  # ==========================================
  # Boolean Assertions
  # ==========================================

  method: assertTrue: condition [
    (condition = 'true') or: [condition = '1']
      ifTrue: [@ self _pass]
      ifFalse: [@ self _fail: 'Expected true']
  ]

  # Snake_case alias - delegates to Smalltalk version
  method: assert_true: condition [
    @ self assertTrue: condition
  ]

  method: assertFalse: condition [
    (condition = 'false') or: [condition = '0'] or: [condition isEmpty]
      ifTrue: [@ self _pass]
      ifFalse: [@ self _fail: 'Expected false']
  ]

  # Snake_case alias - delegates to Smalltalk version
  method: assert_false: condition [
    @ self assertFalse: condition
  ]

  # ==========================================
  # Nil/Empty Assertions
  # ==========================================

  method: assertNil: value [
    (value isEmpty) or: [value = 'null'] ifTrue: [@ self _pass]
                                         ifFalse: [@ self _fail: 'Expected nil/empty value']
  ]

  # Snake_case alias - delegates to Smalltalk version
  method: assert_nil: value [
    @ self assertNil: value
  ]

  method: assertNotNil: value [
    (value notEmpty) and: [value ~= 'null'] ifTrue: [@ self _pass]
                                            ifFalse: [@ self _fail: 'Expected non-nil value']
  ]

  # Snake_case alias - delegates to Smalltalk version
  method: assert_not_nil: value [
    @ self assertNotNil: value
  ]

  # ==========================================
  # String Assertions
  # ==========================================

  rawMethod: assert: haystack contains: needle [
    if echo "$haystack" | grep -qF "$needle"; then
      @ "$_RECEIVER" _pass
    else
      @ "$_RECEIVER" _fail: "Expected '$haystack' to contain '$needle'"
    fi
  ]

  rawMethod: assert_contains [
    local haystack="$1"
    local needle="$2"
    if echo "$haystack" | grep -qF "$needle"; then
      @ "$_RECEIVER" _pass
    else
      @ "$_RECEIVER" _fail: "Expected '$haystack' to contain '$needle'"
    fi
  ]

  method: assert: actual matches: pattern [
    (actual matches: pattern) ifTrue: [@ self _pass]
                              ifFalse: [@ self _fail: 'Pattern match failed']
  ]

  rawMethod: assert_matches [
    local actual="$1"
    local pattern="$2"
    if echo "$actual" | grep -qE "$pattern"; then
      @ "$_RECEIVER" _pass
    else
      @ "$_RECEIVER" _fail: "Expected '$actual' to match pattern '$pattern'"
    fi
  ]

  # ==========================================
  # Numeric Assertions
  # ==========================================

  method: assert: actual greaterThan: expected [
    (actual > expected) ifTrue: [@ self _pass]
                        ifFalse: [@ self _fail: 'Expected greater than']
  ]

  # Snake_case alias - delegates to Smalltalk version
  method: assert_greater_than: actual than: expected [
    @ self assert: actual greaterThan: expected
  ]

  method: assert: actual lessThan: expected [
    (actual < expected) ifTrue: [@ self _pass]
                        ifFalse: [@ self _fail: 'Expected less than']
  ]

  # Snake_case alias - delegates to Smalltalk version
  method: assert_less_than: actual than: expected [
    @ self assert: actual lessThan: expected
  ]

  method: assert: actual greaterOrEqual: expected [
    (actual >= expected) ifTrue: [@ self _pass]
                         ifFalse: [@ self _fail: 'Expected greater or equal']
  ]

  method: assert: actual lessOrEqual: expected [
    (actual <= expected) ifTrue: [@ self _pass]
                         ifFalse: [@ self _fail: 'Expected less or equal']
  ]

  # ==========================================
  # Test Control
  # ==========================================

  rawMethod: skip: reason [
    local test count
    test=$(@ "$_RECEIVER" getCurrentTest)
    count=$(@ "$_RECEIVER" getSkipped)
    @ "$_RECEIVER" setSkipped: $((count + 1))
    echo "  SKIP: $test - $reason"
    return 77  # Special return code to signal skip
  ]

  rawMethod: skip [
    local test count
    test=$(@ "$_RECEIVER" getCurrentTest)
    count=$(@ "$_RECEIVER" getSkipped)
    @ "$_RECEIVER" setSkipped: $((count + 1))
    echo "  SKIP: $test - No reason given"
    return 77
  ]

  rawMethod: pending: description [
    local test count
    test=$(@ "$_RECEIVER" getCurrentTest)
    count=$(@ "$_RECEIVER" getSkipped)
    @ "$_RECEIVER" setSkipped: $((count + 1))
    echo "  PENDING: $test - $description"
    return 77
  ]

  rawMethod: pending [
    local test count
    test=$(@ "$_RECEIVER" getCurrentTest)
    count=$(@ "$_RECEIVER" getSkipped)
    @ "$_RECEIVER" setSkipped: $((count + 1))
    echo "  PENDING: $test - Not yet implemented"
    return 77
  ]

  method: fail: message [
    @ self _fail: message
  ]

  method: fail [
    @ self _fail: 'Explicit failure'
  ]

  # ==========================================
  # Internal Methods
  # ==========================================

  method: _pass [
    | count |
    count := $(@ self getPassed)
    @ self setPassed: $((count + 1))
  ]

  rawMethod: _fail: message [
    local count test
    count=$(@ "$_RECEIVER" getFailed)
    test=$(@ "$_RECEIVER" getCurrentTest)
    @ "$_RECEIVER" setFailed: $((count + 1))
    echo "  FAIL: $test - $message" >&2
  ]

  # ==========================================
  # Test Runner
  # ==========================================

  rawMethod: runTest: methodName [
    @ "$_RECEIVER" setCurrentTest: "$methodName"
    @ "$_RECEIVER" setUp
    @ "$_RECEIVER" "$methodName"
    local result=$?
    @ "$_RECEIVER" tearDown
    return $result
  ]

  rawClassMethod: runAll [
    local instance passed failed skipped total
    instance=$(@ $_CLASS new)

    echo "Running $_CLASS tests..."
    echo ""

    # Find and run all test methods
    for method in $(declare -F | grep "__${_CLASS}__test" | sed "s/.*__${_CLASS}__//"); do
      echo "  Running: $method"
      @ "$instance" runTest: "$method"
    done

    passed=$(@ "$instance" getPassed)
    failed=$(@ "$instance" getFailed)
    skipped=$(@ "$instance" getSkipped)
    total=$((passed + failed))

    echo ""
    echo "----------------------------------------"
    if [[ "$failed" -eq 0 ]]; then
      echo "OK: $passed assertions passed"
    else
      echo "FAILED: $passed passed, $failed failed"
    fi
    if [[ "$skipped" -gt 0 ]]; then
      echo "Skipped: $skipped"
    fi
    echo "----------------------------------------"

    @ "$instance" delete
    return "$failed"
  ]
__TRASHTALK_SOURCE_EOF__
}

__TestCase__passed() {
  echo "$(_ivar passed)"; return
}

__TestCase__passed_() {
  _ivar_set passed "$1"
}

__TestCase__getPassed() {
  echo "$(_ivar passed)"; return
}

__TestCase__setPassed_() {
  _ivar_set passed "$1"
}
__TestCase__failed() {
  echo "$(_ivar failed)"; return
}

__TestCase__failed_() {
  _ivar_set failed "$1"
}

__TestCase__getFailed() {
  echo "$(_ivar failed)"; return
}

__TestCase__setFailed_() {
  _ivar_set failed "$1"
}
__TestCase__skipped() {
  echo "$(_ivar skipped)"; return
}

__TestCase__skipped_() {
  _ivar_set skipped "$1"
}

__TestCase__getSkipped() {
  echo "$(_ivar skipped)"; return
}

__TestCase__setSkipped_() {
  _ivar_set skipped "$1"
}
__TestCase__currentTest() {
  echo "$(_ivar currentTest)"; return
}

__TestCase__currentTest_() {
  _ivar_set currentTest "$1"
}

__TestCase__getCurrentTest() {
  echo "$(_ivar currentTest)"; return
}

__TestCase__setCurrentTest_() {
  _ivar_set currentTest "$1"
}

__TestCase__class__new() {
    local id
    id=$(_generate_instance_id "$_CLASS")
    _create_instance "$_CLASS" "$id"
    echo "$id"
}

__TestCase__setUp() {
  echo "nil"; return
}

__TestCase__tearDown() {
  echo "nil"; return
}

__TestCase__assert_equals_() {
  local actual="$1"
  local expected="$2"
  if [[ "$actual" == "$expected" ]]; then @ "$_RECEIVER" _pass; else @ "$_RECEIVER" : 'Values not equal' fail: null; fi
}

__TestCase__assert_equals() {
    local actual="$1"
    local expected="$2"
    @ "$_RECEIVER" assert: "$actual" equals: "$expected"
}

__TestCase__assert_notEquals_() {
  local actual="$1"
  local expected="$2"
  if [[ "$actual" != "$expected" ]]; then @ "$_RECEIVER" _pass; else @ "$_RECEIVER" : 'Values should not be equal' fail: null; fi
}

__TestCase__assert_not_equals() {
    local actual="$1"
    local expected="$2"
    @ "$_RECEIVER" assert: "$actual" notEquals: "$expected"
}

__TestCase__assertTrue_() {
  local condition="$1"
  if [[ "$condition" == "true" ]] || [[ "$condition" == "1" ]]; then @ "$_RECEIVER" _pass; else @ "$_RECEIVER" : 'Expected true' fail: null; fi
}

__TestCase__assert_true_() {
  local condition="$1"
  @ "$_RECEIVER" assertTrue: $condition
}

__TestCase__assertFalse_() {
  local condition="$1"
  if [[ "$condition" == "false" ]] || [[ "$condition" == "0" ]] || [[ -z "$condition" ]]; then @ "$_RECEIVER" _pass; else @ "$_RECEIVER" : 'Expected false' fail: null; fi
}

__TestCase__assert_false_() {
  local condition="$1"
  @ "$_RECEIVER" assertFalse: $condition
}

__TestCase__assertNil_() {
  local value="$1"
  if [[ -z "$value" ]] || [[ "$value" == "null" ]]; then @ "$_RECEIVER" _pass; else @ "$_RECEIVER" : 'Expected nil/empty value' fail: null; fi
}

__TestCase__assert_nil_() {
  local value="$1"
  @ "$_RECEIVER" assertNil: $value
}

__TestCase__assertNotNil_() {
  local value="$1"
  if [[ -n "$value" ]] && [[ "$value" != "null" ]]; then @ "$_RECEIVER" _pass; else @ "$_RECEIVER" : 'Expected non-nil value' fail: null; fi
}

__TestCase__assert_not_nil_() {
  local value="$1"
  @ "$_RECEIVER" assertNotNil: $value
}

__TestCase__assert_contains_() {
  local haystack="$1"
  local needle="$2"
    if echo "$haystack" | grep -qF "$needle"; then
        @ "$_RECEIVER" _pass
        else
        @ "$_RECEIVER" _fail: "Expected '$haystack' to contain '$needle'"
    fi
}

__TestCase__assert_contains() {
    local haystack="$1"
    local needle="$2"
    if echo "$haystack" | grep -qF "$needle"; then
        @ "$_RECEIVER" _pass
        else
        @ "$_RECEIVER" _fail: "Expected '$haystack' to contain '$needle'"
    fi
}

__TestCase__assert_matches_() {
  local actual="$1"
  local pattern="$2"
  if [[ "$actual" =~ $pattern ]]; then @ "$_RECEIVER" _pass; else @ "$_RECEIVER" : 'Pattern match failed' fail: null; fi
}

__TestCase__assert_matches() {
    local actual="$1"
    local pattern="$2"
    if echo "$actual" | grep -qE "$pattern"; then
        @ "$_RECEIVER" _pass
        else
        @ "$_RECEIVER" _fail: "Expected '$actual' to match pattern '$pattern'"
    fi
}

__TestCase__assert_greaterThan_() {
  local actual="$1"
  local expected="$2"
  if (( $actual > $expected )); then @ "$_RECEIVER" _pass; else @ "$_RECEIVER" : 'Expected greater than' fail: null; fi
}

__TestCase__assert_greater_than_than_() {
  local actual="$1"
  local expected="$2"
  @ "$_RECEIVER" assert: $actual greaterThan: $expected
}

__TestCase__assert_lessThan_() {
  local actual="$1"
  local expected="$2"
  if (( $actual < $expected )); then @ "$_RECEIVER" _pass; else @ "$_RECEIVER" : 'Expected less than' fail: null; fi
}

__TestCase__assert_less_than_than_() {
  local actual="$1"
  local expected="$2"
  @ "$_RECEIVER" assert: $actual lessThan: $expected
}

__TestCase__assert_greaterOrEqual_() {
  local actual="$1"
  local expected="$2"
  if (( $actual >= $expected )); then @ "$_RECEIVER" _pass; else @ "$_RECEIVER" : 'Expected greater or equal' fail: null; fi
}

__TestCase__assert_lessOrEqual_() {
  local actual="$1"
  local expected="$2"
  if (( $actual <= $expected )); then @ "$_RECEIVER" _pass; else @ "$_RECEIVER" : 'Expected less or equal' fail: null; fi
}

__TestCase__skip_() {
  local reason="$1"
    local test count
    test=$(@ "$_RECEIVER" getCurrentTest)
    count=$(@ "$_RECEIVER" getSkipped)
    @ "$_RECEIVER" setSkipped: $((count + 1))
    echo " SKIP: $test - $reason"
    return 77 # Special return code to signal skip
}

__TestCase__skip() {
    local test count
    test=$(@ "$_RECEIVER" getCurrentTest)
    count=$(@ "$_RECEIVER" getSkipped)
    @ "$_RECEIVER" setSkipped: $((count + 1))
    echo " SKIP: $test - No reason given"
    return 77
}

__TestCase__pending_() {
  local description="$1"
    local test count
    test=$(@ "$_RECEIVER" getCurrentTest)
    count=$(@ "$_RECEIVER" getSkipped)
    @ "$_RECEIVER" setSkipped: $((count + 1))
    echo " PENDING: $test - $description"
    return 77
}

__TestCase__pending() {
    local test count
    test=$(@ "$_RECEIVER" getCurrentTest)
    count=$(@ "$_RECEIVER" getSkipped)
    @ "$_RECEIVER" setSkipped: $((count + 1))
    echo " PENDING: $test - Not yet implemented"
    return 77
}

__TestCase__fail_() {
  local message="$1"
  @ "$_RECEIVER" : $message fail: null
}

__TestCase__fail() {
  @ "$_RECEIVER" : 'Explicit failure' fail: null
}

__TestCase___pass() {
  local count
  count="$(@ "$_RECEIVER" getPassed)"
  @ "$_RECEIVER" setPassed: $((count + 1))
}

__TestCase___fail_() {
  local message="$1"
    local count test
    count=$(@ "$_RECEIVER" getFailed)
    test=$(@ "$_RECEIVER" getCurrentTest)
    @ "$_RECEIVER" setFailed: $((count + 1))
    echo " FAIL: $test - $message" >&2
}

__TestCase__runTest_() {
  local methodName="$1"
    @ "$_RECEIVER" setCurrentTest: "$methodName"
    @ "$_RECEIVER" setUp
    @ "$_RECEIVER" "$methodName"
    local result=$?
    @ "$_RECEIVER" tearDown
    return $result
}

__TestCase__class__runAll() {
    local instance passed failed skipped total
    instance=$(@ $_CLASS new)

    echo "Running $_CLASS tests..."
    echo ""

    # Find and run all test methods
    for method in $(declare -F | grep "__${_CLASS}__test" | sed "s/.*__${_CLASS}__//"); do
        echo " Running: $method"
        @ "$instance" runTest: "$method"
    done

    passed=$(@ "$instance" getPassed)
    failed=$(@ "$instance" getFailed)
    skipped=$(@ "$instance" getSkipped)
    total=$((passed + failed))

    echo ""
    echo "----------------------------------------"
    if [[ "$failed" -eq 0 ]]; then
        echo "OK: $passed assertions passed"
        else
        echo "FAILED: $passed passed, $failed failed"
    fi
    if [[ "$skipped" -gt 0 ]]; then
        echo "Skipped: $skipped"
    fi
    echo "----------------------------------------"

    @ "$instance" delete
    return "$failed"
}
