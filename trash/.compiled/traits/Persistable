#!/usr/bin/env bash
# Generated by Trashtalk Compiler (jq) - DO NOT EDIT
# Source: Persistable.trash (trait)
# Generated: 2025-12-25T20:44:54

__Persistable__is_trait="1"

__Persistable__save() {
    _env_persist "$_RECEIVER"
}

__Persistable__unpersist() {
    db_delete "$_RECEIVER" 2>/dev/null
}

__Persistable__delete() {
    db_delete "$_RECEIVER" 2>/dev/null
    _env_delete "$_RECEIVER"
}

__Persistable__isPersisted() {
    if _env_is_persisted "$_RECEIVER"; then
        echo "true"
        else
        echo "false"
    fi
}

__Persistable__reload() {
    _env_load "$_RECEIVER"
}

__Persistable__asJson() {
    _env_get "$_RECEIVER"
}

__Persistable__class__create() {
    local instance_id
    instance_id=$(_generate_instance_id "$_CLASS")
    _create_instance "$_CLASS" "$instance_id"
    _env_persist "$instance_id"
    echo "$instance_id"
}

__Persistable__class__findAll() {
    db_find_by_class "$_CLASS"
}

__Persistable__class__count() {
    db_count_by_class "$_CLASS"
}

__Persistable__class__find() {
    local predicate="$1"

    if [[ -z "$predicate" ]]; then
        db_find_by_class "$_CLASS"
        return
    fi

    _find_with_predicate "$_CLASS" "$predicate"
}

__Persistable__class__loadAll() {
    local ids id
    ids=$(db_find_by_class "$_CLASS")
    for id in $ids; do
        _env_load "$id" 2>/dev/null
    done
}
