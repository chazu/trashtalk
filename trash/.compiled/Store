#!/usr/bin/env bash
# Generated by Trashtalk Compiler (jq) - DO NOT EDIT
# Source: Store.trash
# Generated: 2025-12-25T20:43:41

__Store__superclass="Object"
__Store__instanceVars=""
__Store__classInstanceVars=""
__Store__traits=""

__Store__class__init() {
  db_init
}

__Store__class__createInstance_id_data_() {
  local class_name="$1"
  local instance_id="$2"
  local initial_data="$3"
  local created_at full_data
  created_at=$(date +%s)
  full_data=$(echo "$initial_data" | jq -c ". + {class: \"$class_name\", created_at: \"$created_at\"}")
  db_put "$instance_id" "$full_data"
}

__Store__class__getInstance_() {
  local instance_id="$1"
  db_get "$instance_id"
}

__Store__class__getField_field_() {
  local instance_id="$1"
  local field="$2"
  local data
  data=$(db_get "$instance_id")
  [[ -n "$data" ]] && echo "$data" | jq -r ".$field // empty"
}

__Store__class__setField_field_value_() {
  local instance_id="$1"
  local field="$2"
  local value="$3"
  local data updated
  data=$(db_get "$instance_id")
  if [[ -z "$data" ]]; then
  echo "Error: Instance $instance_id not found" >&2
  return 1
  fi
  if [[ "$value" =~ ^-?[0-9]+$ ]]; then
  updated=$(echo "$data" | jq -c ".$field = $value")
  else
  updated=$(echo "$data" | jq -c ".$field = \"$value\"")
  fi
  db_put "$instance_id" "$updated"
}

__Store__class__deleteInstance_() {
  local instance_id="$1"
  db_delete "$instance_id"
}

__Store__class__getClass_() {
  local instance_id="$1"
  @ Store getField: "$instance_id" field: "class"
}

__Store__class__isInstance_() {
  local instance_id="$1"
  local class_name
  class_name=$(@ Store getClass "$instance_id")
  [[ -n "$class_name" ]]
}

__Store__class__findByClass_() {
  local class_name="$1"
  db_find_by_class "$class_name"
}

__Store__class__countByClass_() {
  local class_name="$1"
  db_count_by_class "$class_name"
}

__Store__class__listClasses() {
  db_list_classes
}

__Store__class__query_() {
  local where_clause="$1"
  db_query "$where_clause"
}

__Store__class__queryData_() {
  local where_clause="$1"
  db_query_data "$where_clause"
}

__Store__class__ensureIndex_path_() {
  local column_name="$1"
  local json_path="$2"
  db_ensure_virtual_column "$column_name" "$json_path" 2>/dev/null || true
  db_create_index "$column_name" 2>/dev/null || true
}

__Store__class__listIndices() {
  db_list_indices
}

__Store__class__listColumns() {
  db_list_columns
}

__Store__class__clear() {
  db_clear
}
