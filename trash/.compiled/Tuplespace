#!/usr/bin/env bash
# Generated by Trashtalk Compiler (jq) - DO NOT EDIT
# Source: Tuplespace.trash
# Generated: 2026-01-08T14:14:42

__Tuplespace__superclass="Object"
__Tuplespace__instanceVars=""
__Tuplespace__classInstanceVars=""
__Tuplespace__traits="Debuggable"
__Tuplespace__sourceHash="57944662c68880fb1d00b7e342cba572fb7910868ddf56843b7125f0cc009223"

__Tuplespace__source() {
  cat <<'__TRASHTALK_SOURCE_EOF__'
# Tuplespace - Trash object wrapper for tuplespace.bash functionality
# Provides message-passing API for coordinated event-driven programming
Tuplespace subclass: Object
  include: Debuggable
  requires: '$SCRIPT_DIR/vendor/tuplespace/tuplespace.bash'

  # Initialize the tuplespace system
  method: init [
    @ "$_RECEIVER" debug: "Initializing tuplespace system"
    ts_init
    echo "Tuplespace initialized at $TUPLESPACE_DIR"
  ]

  # Put a tuple into the space (varargs: type key1 val1 key2 val2 ...)
  rawMethod: put [
    @ "$_RECEIVER" debug: "Putting tuple of type: $1"
    ts_put "$@"
  ]

  # Get tuples matching criteria (read without removing)
  rawMethod: get [
    @ "$_RECEIVER" debug: "Getting tuples of type: $1"
    ts_get "$@"
  ]

  # Take tuples matching criteria (read and remove)
  rawMethod: take [
    @ "$_RECEIVER" debug: "Taking tuples of type: $1"
    ts_take "$@"
  ]

  # Wait for tuples matching criteria
  rawMethod: wait [
    @ "$_RECEIVER" debug: "Waiting for tuples of type: $1"
    ts_wait "$@"
  ]

  # Listen for events on tuples of a specific type
  method: listen: tuple_type command: command [
    @ "$_RECEIVER" debug: "Setting up listener for type: $tuple_type"
    ts_listen "$tuple_type" "$command"
  ]

  # Stop a listener
  method: stopListener: tuple_type process: process_id [
    @ "$_RECEIVER" debug: "Stopping listener for type: $tuple_type, process: $process_id"
    ts_stop_listener "$tuple_type" "$process_id"
  ]

  # Extract field from tuple record
  method: field: tuple_record name: field_name [
    ts_field "$tuple_record" "$field_name"
  ]

  # List all tuples in the space
  method: list [
    @ "$_RECEIVER" debug: "Listing all tuples"
    ts_list
  ]

  # Count tuples by type (optional type argument)
  rawMethod: count [
    local tuple_type="$1"
    if [[ -n "$tuple_type" ]]; then
      @ "$_RECEIVER" debug: "Counting tuples of type: $tuple_type"
    else
      @ "$_RECEIVER" debug: "Counting all tuples"
    fi
    ts_count "$tuple_type"
  ]

  # Clear all tuples from the space
  method: clear [
    @ "$_RECEIVER" debug: "Clearing all tuples from tuplespace"
    ts_clear
  ]

  # Put a key-value pair
  method: putKV: key value: value [
    @ "$_RECEIVER" debug: "Putting key-value: $key = $value"
    ts_kv_put "$key" "$value"
  ]

  # Simple varargs version of putKV
  rawMethod: putKV [
    @ "$_RECEIVER" debug: "Putting key-value: $1 = $2"
    ts_kv_put "$1" "$2"
  ]

  # Get value by key
  method: getKV: key [
    @ "$_RECEIVER" debug: "Getting value for key: $key"
    ts_kv_get "$key"
  ]

  # Simple varargs version of getKV
  rawMethod: getKV [
    @ "$_RECEIVER" debug: "Getting value for key: $1"
    ts_kv_get "$1"
  ]

  # Put an event
  method: putEvent: event_name data: data [
    @ "$_RECEIVER" debug: "Putting event: $event_name"
    ts_event_put "$event_name" "$data"
  ]

  # Simple varargs version of putEvent
  rawMethod: putEvent [
    @ "$_RECEIVER" debug: "Putting event: $1"
    ts_event_put "$1" "$2"
  ]

  # Run the demo/test suite
  method: test [
    ts_demo
  ]

  # System information
  method: info [
    echo "=== Tuplespace System Information ==="
    echo "Directory: $TUPLESPACE_DIR"
    echo "Database: $TUPLESPACE_DB"
    echo "Events Dir: $TUPLESPACE_EVENTS_DIR"
    echo "Listeners Dir: $TUPLESPACE_LISTENERS_DIR"
    echo "Total tuples: $(ts_count)"
    echo ""
    echo "Tuple types:"
    if [[ -s "$TUPLESPACE_DB" ]]; then
      recsel "$TUPLESPACE_DB" | grep "^Type:" | sort | uniq -c | sed 's/^/  /'
    else
      echo "  (no tuples)"
    fi
  ]

  # === Methods for Process compatibility ===

  # Put with named args (alias for put)
  rawMethod: put_args [
    @ "$_RECEIVER" debug: "Putting tuple (put_args): $1"
    ts_put "$@"
  ]

  # Get tuples by key-value match
  # Usage: @ Tuplespace get_key_value "process" "id" "proc_123"
  rawMethod: get_key_value [
    local tuple_type="$1"
    local key="$2"
    local value="$3"
    @ "$_RECEIVER" debug: "Getting $tuple_type where $key = $value"
    ts_get "$tuple_type" "$key" "$value"
  ]

  # Take (remove) tuples by key-value match
  # Usage: @ Tuplespace take_key_value "process" "id" "proc_123"
  rawMethod: take_key_value [
    local tuple_type="$1"
    local key="$2"
    local value="$3"
    @ "$_RECEIVER" debug: "Taking $tuple_type where $key = $value"
    ts_take "$tuple_type" "$key" "$value"
  ]

  # Wait for tuple with timeout
  # Usage: @ Tuplespace wait_key_value_timeout "message" "target" "proc_123" 10
  rawMethod: wait_key_value_timeout [
    local tuple_type="$1"
    local key="$2"
    local value="$3"
    local timeout="${4:-10}"
    @ "$_RECEIVER" debug: "Waiting for $tuple_type where $key = $value (timeout: ${timeout}s)"
    ts_wait "$tuple_type" "$key" "$value" "$timeout"
  ]

  # Extract field from tuple by name
  # Usage: echo "$tuple" | @ Tuplespace field_name - "status"
  # Or: @ Tuplespace field_name "$tuple" "status"
  rawMethod: field_name [
    local tuple_record="$1"
    local field_name="$2"
    ts_field "$tuple_record" "$field_name"
  ]

  # Put event with data (simpler syntax)
  # Usage: @ Tuplespace putEvent_data "process_started" "proc_123"
  rawMethod: putEvent_data [
    local event_name="$1"
    local data="$2"
    @ "$_RECEIVER" debug: "Putting event: $event_name with data: $data"
    ts_event_put "$event_name" "$data"
  ]

  # Show help
  method: help [
    echo "=== Tuplespace Commands ==="
    echo ""
    echo "Basic Operations:"
    echo "  @ Tuplespace put <type> <k1> <v1> ...        - Put tuple"
    echo "  @ Tuplespace get <type> [key] [value]        - Get tuples (non-destructive)"
    echo "  @ Tuplespace take <type> [key] [value]       - Take tuples (removes them)"
    echo "  @ Tuplespace wait <type> [key] [val] [timeout] - Block until tuple exists"
    echo ""
    echo "Query Methods:"
    echo "  @ Tuplespace get_key_value <type> <key> <val>  - Get by key-value"
    echo "  @ Tuplespace take_key_value <type> <key> <val> - Take by key-value"
    echo "  @ Tuplespace wait_key_value_timeout <t> <k> <v> <sec> - Wait with timeout"
    echo "  @ Tuplespace field_name <tuple> <field>        - Extract field from tuple"
    echo ""
    echo "Event System:"
    echo "  @ Tuplespace putEvent <name> [data]          - Put event tuple"
    echo "  @ Tuplespace putEvent_data <name> <data>     - Put event (explicit)"
    echo "  @ Tuplespace listen <type> <command>         - Listen for events"
    echo "  @ Tuplespace stopListener <type> <pid>       - Stop listener"
    echo ""
    echo "Key-Value Convenience:"
    echo "  @ Tuplespace putKV <key> <value>             - Put key-value pair"
    echo "  @ Tuplespace getKV <key>                     - Get value by key"
    echo ""
    echo "Utility:"
    echo "  @ Tuplespace list                            - List all tuples"
    echo "  @ Tuplespace count [type]                    - Count tuples"
    echo "  @ Tuplespace clear                           - Clear all tuples"
    echo "  @ Tuplespace info                            - System info"
    echo "  @ Tuplespace init                            - Initialize system"
  ]
__TRASHTALK_SOURCE_EOF__
}

# Required dependencies
source "$SCRIPT_DIR/vendor/tuplespace/tuplespace.bash"

__Tuplespace__init() {
  @ "$_RECEIVER" debug: "Initializing tuplespace system"
  ts_init
  echo "Tuplespace initialized at $TUPLESPACE_DIR"
}

__Tuplespace__put() {
    @ "$_RECEIVER" debug: "Putting tuple of type: $1"
    ts_put "$@"
}

__Tuplespace__get() {
    @ "$_RECEIVER" debug: "Getting tuples of type: $1"
    ts_get "$@"
}

__Tuplespace__take() {
    @ "$_RECEIVER" debug: "Taking tuples of type: $1"
    ts_take "$@"
}

__Tuplespace__wait() {
    @ "$_RECEIVER" debug: "Waiting for tuples of type: $1"
    ts_wait "$@"
}

__Tuplespace__listen_command_() {
  local tuple_type="$1"
  local command="$2"
  @ "$_RECEIVER" debug: "Setting up listener for type: $tuple_type"
  ts_listen "$tuple_type" "$command"
}

__Tuplespace__stopListener_process_() {
  local tuple_type="$1"
  local process_id="$2"
  @ "$_RECEIVER" debug: "Stopping listener for type: $tuple_type, process: $process_id"
  ts_stop_listener "$tuple_type" "$process_id"
}

__Tuplespace__field_name_() {
  local tuple_record="$1"
  local field_name="$2"
  ts_field "$tuple_record" "$field_name"
}

__Tuplespace__list() {
  @ "$_RECEIVER" debug: "Listing all tuples"
  ts_list
}

__Tuplespace__count() {
    local tuple_type="$1"
    if [[ -n "$tuple_type" ]]; then
        @ "$_RECEIVER" debug: "Counting tuples of type: $tuple_type"
        else
        @ "$_RECEIVER" debug: "Counting all tuples"
    fi
    ts_count "$tuple_type"
}

__Tuplespace__clear() {
  @ "$_RECEIVER" debug: "Clearing all tuples from tuplespace"
  ts_clear
}

__Tuplespace__putKV_value_() {
  local key="$1"
  local value="$2"
  @ "$_RECEIVER" debug: "Putting key-value: $key = $value"
  ts_kv_put "$key" "$value"
}

__Tuplespace__putKV() {
    @ "$_RECEIVER" debug: "Putting key-value: $1=$2"
    ts_kv_put "$1" "$2"
}

__Tuplespace__getKV_() {
  local key="$1"
  @ "$_RECEIVER" debug: "Getting value for key: $key"
  ts_kv_get "$key"
}

__Tuplespace__getKV() {
    @ "$_RECEIVER" debug: "Getting value for key: $1"
    ts_kv_get "$1"
}

__Tuplespace__putEvent_data_() {
  local event_name="$1"
  local data="$2"
  @ "$_RECEIVER" debug: "Putting event: $event_name"
  ts_event_put "$event_name" "$data"
}

__Tuplespace__putEvent() {
    @ "$_RECEIVER" debug: "Putting event: $1"
    ts_event_put "$1" "$2"
}

__Tuplespace__test() {
  ts_demo
}

__Tuplespace__info() {
  echo "=== Tuplespace System Information ==="
  echo "Directory: $TUPLESPACE_DIR"
  echo "Database: $TUPLESPACE_DB"
  echo "Events Dir: $TUPLESPACE_EVENTS_DIR"
  echo "Listeners Dir: $TUPLESPACE_LISTENERS_DIR"
  echo "Total tuples: $(ts_count)"
  echo ""
  echo "Tuple types:"
  if [[ -s "$TUPLESPACE_DB" ]]; then
  recsel "$TUPLESPACE_DB" | grep "^Type:" | sort | uniq -c | sed 's/^/ /'
  else
  echo " (no tuples)"
  fi
}

__Tuplespace__put_args() {
    @ "$_RECEIVER" debug: "Putting tuple (put_args): $1"
    ts_put "$@"
}

__Tuplespace__get_key_value() {
    local tuple_type="$1"
    local key="$2"
    local value="$3"
    @ "$_RECEIVER" debug: "Getting $tuple_type where $key=$value"
    ts_get "$tuple_type" "$key" "$value"
}

__Tuplespace__take_key_value() {
    local tuple_type="$1"
    local key="$2"
    local value="$3"
    @ "$_RECEIVER" debug: "Taking $tuple_type where $key=$value"
    ts_take "$tuple_type" "$key" "$value"
}

__Tuplespace__wait_key_value_timeout() {
    local tuple_type="$1"
    local key="$2"
    local value="$3"
    local timeout="${4:-10}"
    @ "$_RECEIVER" debug: "Waiting for $tuple_type where $key=$value (timeout: ${timeout}s)"
    ts_wait "$tuple_type" "$key" "$value" "$timeout"
}

__Tuplespace__field_name() {
    local tuple_record="$1"
    local field_name="$2"
    ts_field "$tuple_record" "$field_name"
}

__Tuplespace__putEvent_data() {
    local event_name="$1"
    local data="$2"
    @ "$_RECEIVER" debug: "Putting event: $event_name with data: $data"
    ts_event_put "$event_name" "$data"
}

__Tuplespace__help() {
  echo "=== Tuplespace Commands ==="
  echo ""
  echo "Basic Operations:"
  echo " @ Tuplespace put <type> <k1> <v1> ... - Put tuple"
  echo " @ Tuplespace get <type> [key] [value] - Get tuples (non-destructive)"
  echo " @ Tuplespace take <type> [key] [value] - Take tuples (removes them)"
  echo " @ Tuplespace wait <type> [key] [val] [timeout] - Block until tuple exists"
  echo ""
  echo "Query Methods:"
  echo " @ Tuplespace get_key_value <type> <key> <val> - Get by key-value"
  echo " @ Tuplespace take_key_value <type> <key> <val> - Take by key-value"
  echo " @ Tuplespace wait_key_value_timeout <t> <k> <v> <sec> - Wait with timeout"
  echo " @ Tuplespace field_name <tuple> <field> - Extract field from tuple"
  echo ""
  echo "Event System:"
  echo " @ Tuplespace putEvent <name> [data] - Put event tuple"
  echo " @ Tuplespace putEvent_data <name> <data> - Put event (explicit)"
  echo " @ Tuplespace listen <type> <command> - Listen for events"
  echo " @ Tuplespace stopListener <type> <pid> - Stop listener"
  echo ""
  echo "Key-Value Convenience:"
  echo " @ Tuplespace putKV <key> <value> - Put key-value pair"
  echo " @ Tuplespace getKV <key> - Get value by key"
  echo ""
  echo "Utility:"
  echo " @ Tuplespace list - List all tuples"
  echo " @ Tuplespace count [type] - Count tuples"
  echo " @ Tuplespace clear - Clear all tuples"
  echo " @ Tuplespace info - System info"
  echo " @ Tuplespace init - Initialize system"
}
