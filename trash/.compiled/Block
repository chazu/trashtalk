#!/usr/bin/env bash
# Generated by Trashtalk Compiler (jq) - DO NOT EDIT
# Source: Block.trash
# Generated: 2026-01-06T00:53:12

__Block__superclass="Object"
__Block__instanceVars="params code captured"
__Block__classInstanceVars=""
__Block__traits=""
__Block__sourceHash="c850063eee975de2527afa64077fc557bec0642497c059fae2aeb5bc769cd1cc"

__Block__source() {
  cat <<'__TRASHTALK_SOURCE_EOF__'
Block subclass: Object
  instanceVars: params code captured

  # Create a new block with parameters, code, and captured variables
  # params: JSON array of parameter names ["x", "y"]
  # code: string of code to execute
  # captured: JSON object of captured variables {"_RECEIVER": "counter_abc123"}
  classMethod: params: p code: c captured: cap [
    | id |
    id := $(_generate_instance_id Block)
    _create_instance Block "$id"
    @ "$id" setParams "$p"
    @ "$id" setCode "$c"
    @ "$id" setCaptured "$cap"
    ^ "$id"
  ]

  # Execute block with no arguments
  rawMethod: value [
    local code params captured
    code=$(@ "$_RECEIVER" getCode)
    params=$(@ "$_RECEIVER" getParams)
    captured=$(@ "$_RECEIVER" getCaptured)

    # Restore captured variables
    local _saved_RECEIVER="$_RECEIVER"
    if [[ -n "$captured" && "$captured" != "null" ]]; then
      local cap_receiver
      cap_receiver=$(echo "$captured" | jq -r '._RECEIVER // empty')
      [[ -n "$cap_receiver" ]] && _RECEIVER="$cap_receiver"
    fi

    # Execute the code
    eval "$code"
    local result=$?

    # Restore context
    _RECEIVER="$_saved_RECEIVER"
    return $result
  ]

  # Execute block with one argument
  # Note: Named valueWith: to avoid collision with value (0-arg version)
  rawMethod: valueWith: arg [
    local code params captured arg1="$1"
    code=$(@ "$_RECEIVER" getCode)
    params=$(@ "$_RECEIVER" getParams)
    captured=$(@ "$_RECEIVER" getCaptured)

    # Get parameter name
    local param1
    param1=$(echo "$params" | jq -r '.[0] // empty')

    # Restore captured variables
    local _saved_RECEIVER="$_RECEIVER"
    if [[ -n "$captured" && "$captured" != "null" ]]; then
      local cap_receiver
      cap_receiver=$(echo "$captured" | jq -r '._RECEIVER // empty')
      [[ -n "$cap_receiver" ]] && _RECEIVER="$cap_receiver"
    fi

    # Bind parameter and execute
    if [[ -n "$param1" ]]; then
      eval "local $param1=\"$arg1\"; $code"
    else
      eval "$code"
    fi
    local result=$?

    # Restore context
    _RECEIVER="$_saved_RECEIVER"
    return $result
  ]

  # Execute block with two arguments
  rawMethod: valueWith: a and: b [
    local code params captured arg1="$1" arg2="$2"
    code=$(@ "$_RECEIVER" getCode)
    params=$(@ "$_RECEIVER" getParams)
    captured=$(@ "$_RECEIVER" getCaptured)

    # Get parameter names
    local param1 param2
    param1=$(echo "$params" | jq -r '.[0] // empty')
    param2=$(echo "$params" | jq -r '.[1] // empty')

    # Restore captured variables
    local _saved_RECEIVER="$_RECEIVER"
    if [[ -n "$captured" && "$captured" != "null" ]]; then
      local cap_receiver
      cap_receiver=$(echo "$captured" | jq -r '._RECEIVER // empty')
      [[ -n "$cap_receiver" ]] && _RECEIVER="$cap_receiver"
    fi

    # Bind parameters and execute
    local bindings=""
    [[ -n "$param1" ]] && bindings="local $param1=\"$arg1\"; "
    [[ -n "$param2" ]] && bindings="${bindings}local $param2=\"$arg2\"; "
    eval "${bindings}$code"
    local result=$?

    # Restore context
    _RECEIVER="$_saved_RECEIVER"
    return $result
  ]

  # Return number of parameters
  method: numArgs [
    | p |
    p := $(@ self getParams).
    ^ $(echo "$p" | jq 'length')
  ]
__TRASHTALK_SOURCE_EOF__
}

__Block__params() {
  echo "$(_ivar params)"; return
}

__Block__params_() {
  _ivar_set params "$1"
}

__Block__getParams() {
  echo "$(_ivar params)"; return
}

__Block__setParams_() {
  _ivar_set params "$1"
}
__Block__code() {
  echo "$(_ivar code)"; return
}

__Block__code_() {
  _ivar_set code "$1"
}

__Block__getCode() {
  echo "$(_ivar code)"; return
}

__Block__setCode_() {
  _ivar_set code "$1"
}
__Block__captured() {
  echo "$(_ivar captured)"; return
}

__Block__captured_() {
  _ivar_set captured "$1"
}

__Block__getCaptured() {
  echo "$(_ivar captured)"; return
}

__Block__setCaptured_() {
  _ivar_set captured "$1"
}

__Block__class__params_code_captured_() {
  local p="$1"
  local c="$2"
  local cap="$3"
  local id
  id=$(_generate_instance_id Block)
  _create_instance Block "$id"
  @ "$id" setParams "$p"
  @ "$id" setCode "$c"
  @ "$id" setCaptured "$cap"
  echo "$id"
}

__Block__value() {
    local code params captured
    code=$(@ "$_RECEIVER" getCode)
    params=$(@ "$_RECEIVER" getParams)
    captured=$(@ "$_RECEIVER" getCaptured)

    # Restore captured variables
    local _saved_RECEIVER="$_RECEIVER"
    if [[ -n "$captured" && "$captured" != "null" ]]; then
        local cap_receiver
        cap_receiver=$(echo "$captured" | jq -r '._RECEIVER // empty')
        [[ -n "$cap_receiver" ]] && _RECEIVER="$cap_receiver"
    fi

    # Execute the code
    eval "$code"
    local result=$?

    # Restore context
    _RECEIVER="$_saved_RECEIVER"
    return $result
}

__Block__valueWith_() {
  local arg="$1"
    local code params captured arg1="$1"
    code=$(@ "$_RECEIVER" getCode)
    params=$(@ "$_RECEIVER" getParams)
    captured=$(@ "$_RECEIVER" getCaptured)

    # Get parameter name
    local param1
    param1=$(echo "$params" | jq -r '.[0] // empty')

    # Restore captured variables
    local _saved_RECEIVER="$_RECEIVER"
    if [[ -n "$captured" && "$captured" != "null" ]]; then
        local cap_receiver
        cap_receiver=$(echo "$captured" | jq -r '._RECEIVER // empty')
        [[ -n "$cap_receiver" ]] && _RECEIVER="$cap_receiver"
    fi

    # Bind parameter and execute
    if [[ -n "$param1" ]]; then
        eval "local $param1=\" $arg1 \"; $code"
        else
        eval "$code"
    fi
    local result=$?

    # Restore context
    _RECEIVER="$_saved_RECEIVER"
    return $result
}

__Block__valueWith_and_() {
  local a="$1"
  local b="$2"
    local code params captured arg1="$1" arg2="$2"
    code=$(@ "$_RECEIVER" getCode)
    params=$(@ "$_RECEIVER" getParams)
    captured=$(@ "$_RECEIVER" getCaptured)

    # Get parameter names
    local param1 param2
    param1=$(echo "$params" | jq -r '.[0] // empty')
    param2=$(echo "$params" | jq -r '.[1] // empty')

    # Restore captured variables
    local _saved_RECEIVER="$_RECEIVER"
    if [[ -n "$captured" && "$captured" != "null" ]]; then
        local cap_receiver
        cap_receiver=$(echo "$captured" | jq -r '._RECEIVER // empty')
        [[ -n "$cap_receiver" ]] && _RECEIVER="$cap_receiver"
    fi

    # Bind parameters and execute
    local bindings=""
    [[ -n "$param1" ]] && bindings="local $param1=\" $arg1 \"; "
    [[ -n "$param2" ]] && bindings="${bindings}local $param2=\" $arg2 \"; "
    eval "${bindings}$code"
    local result=$?

    # Restore context
    _RECEIVER="$_saved_RECEIVER"
    return $result
}

__Block__numArgs() {
  local p
  p=$(@ $_RECEIVER getParams).
  echo $(echo "$p" | jq 'length')
}
